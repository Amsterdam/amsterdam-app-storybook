import{j as o}from"./jsx-runtime-DNHyKP0h.js";import{r as g}from"./index-B-xgG2PE.js";import{u as B,F as N}from"./index.esm-DMWELHmA.js";import{B as b}from"./Button-VN6hEk0Y.js";import{S as _}from"./SomethingWentWrong-BBVOy0q1.js";import{T as h}from"./TextInputField-BEUKoc7H.js";import{C as O}from"./Column-CNEXbMdz.js";import{G as V}from"./Gutter-BKlFNIbr.js";import{u as W}from"./useNavigation-CzlnAToN.js";import{N as q}from"./NavigationRouteContext-r2xoHQdm.js";import"./usePiwikTrackCustomEventFromProps-DTbmA5EW.js";import{u as G}from"./useDispatch-jiStvVFn.js";import{u as K,a as H}from"./useLoginSteps-AmoFEI8i.js";import{e as J,f as M,g as U,S as x,h as $,p as z}from"./service-B2khQ2aS.js";import{a as Q}from"./types-C2OYdTo_.js";import{P as y}from"./routes-CtH9nUKh.js";import{d as X,p as S}from"./slice-B4FivVli.js";import{d as Y}from"./useTrackException-BuwXEiys.js";import{P as Z}from"./index-BiinuClr.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./PressableBase-C_jsYHwg.js";import"./index-8vBCaO0e.js";import"./extends-CF3RwP-h.js";import"./index-Cm4QxXoK.js";import"./TextAncestorContext-Z5dgoe9Q.js";import"./index-DoMT7H_C.js";import"./config-BZnShabN.js";import"./Row-BvNvwgkX.js";import"./mapCrossAxisAlignment-DpnuLLqj.js";import"./mapMainAxisAlignment-BOa0GzUh.js";import"./useThemable-DhqiuDXa.js";import"./index-DICU_UuR.js";import"./index-CGHx0_JJ.js";import"./index-CnyDuYXe.js";import"./base-color-BCCzFoQm.js";import"./Icon-CKMhdYjd.js";import"./index-s4hYfBOP.js";import"./index-Chjiymov.js";import"./Animated-45BN0duk.js";import"./index-DoCTQWjN.js";import"./NativeEventEmitter-CjF4_R2K.js";import"./index-u-pG-eXf.js";import"./index-CXGG-aYW.js";import"./types-CttlCamk.js";import"./useDeviceContext-BsghPmC5.js";import"./index-aqbATsDD.js";import"./index-C70cEofB.js";import"./useTheme-6yZg5PNu.js";import"./AccessibleText-ySoCsV7u.js";import"./Pressable-CjkUjF0U.js";import"./Box-BjQfbqk5.js";import"./layoutStyles-Beptdp9x.js";import"./Alert.types-B-Yctuek.js";import"./AlertBase-BAuI5fg0.js";import"./SingleSelectable-UeAGsyNp.js";import"./Paragraph-DQQU4GSI.js";import"./Title-CgSdJu8-.js";import"./useAccessibilityFocus-Caw8Leih.js";import"./index-TB2J_fWb.js";import"./index-996-O__M.js";import"./useIsScreenReaderEnabled-CpYBVHk9.js";import"./duration-BV61i-wJ.js";import"./accessibleText-gmNPjmn1.js";import"./useAccessibilityAnnounce-64AxzTCn.js";import"./CharactersLeftDisplay-DaI6ZiE8.js";import"./TextInput-C4vFoWMA.js";import"./IconButton-CH1xcHzK.js";import"./Badge-BYLpRoy1.js";import"./formatNumber-BOnMa6yj.js";import"./Label-C7PUHL5C.js";import"./Phrase-CYSu-L6-.js";import"./index-shQJSbQb.js";import"./dayjs-C6sMkNK9.js";import"./index-BC3CZ5Nb.js";import"./client-Ci5f1cWN.js";import"./index-DKdc_Qc3.js";import"./index-DeJff1tQ.js";import"./index-sQd6WMHM.js";import"./index-C8evIbG0.js";import"./index-Cy9gAJ_F.js";import"./index-PBkblRt8.js";import"./index-oz3Z5D95.js";import"./iframe-BNPFh_2V.js";function tt(){const t=g.useContext(q);if(t===void 0)throw new Error("Couldn't find a route object. Is your component inside a screen in a navigator?");return t}const rt=()=>tt(),ot=()=>{const{setItem:t}=J();return g.useCallback((i,m)=>M(i,m).then(()=>{t(i)}),[t])},et=t=>t===Q.permitHolder?x.parkingPermitHolder:x.parkingVisitor,it=()=>{const t=ot();return g.useCallback(async(i,m)=>{const u=et(m);let r=[];try{const e=await U(u);if(e){let n;try{n=JSON.parse(e)}catch{n=[]}Array.isArray(n)&&(r=n.filter(s=>typeof s=="object"&&s!==null&&"reportCode"in s&&"pin"in s))}}catch{r=[]}r=r.filter(e=>e.reportCode!==i.reportCode),r.push(i),await t(u,JSON.stringify(r))},[t])},nt=()=>{const{params:t}=rt(),i=W(),{navigate:m,reset:u}=i,r=B({defaultValues:t}),e=g.useRef(null),{setAccessToken:n}=X(),{accessCode:s}=K(),{isLoginStepsActive:A}=H(),{handleSubmit:j}=r,[v,{error:l,isError:L,isLoading:w}]=$(),E=l&&"status"in l&&l.status===403,R=it(),c=G(),T=E?"Controleer uw meldcode en pincode en probeer het opnieuw.":"Er is iets misgegaan. Probeer het opnieuw.",P=j(async({pin:a,reportCode:p})=>{try{const{access_token:f,access_token_expiration:D,scope:k}=await v({pin:a,report_code:p}).unwrap();await R({pin:a,reportCode:p},k),n(p,f,D),c(S.actions.setCurrentAccount(p)),c(S.actions.setCurrentPermitReportCode(void 0)),c(S.actions.setParkingAccount({reportCode:p,scope:k})),c(z.util.resetApiState()),setTimeout(()=>{s&&!A&&u({index:0,routes:[{name:y.dashboard}]})},1e3)}catch(f){Y("ParkingLoginForm onSubmit error:",f)}});return o.jsx(N,{...r,children:o.jsxs(O,{gutter:"md",children:[o.jsx(h,{autoFocus:!0,hasClearButton:!1,keyboardType:"number-pad",label:"Meldcode",name:"reportCode",onSubmitEditing:()=>{var a;(a=e.current)==null||a.focus()},returnKeyType:Z.OS!=="ios"?"done":void 0,rules:{required:"Vul een meldcode in"},submitBehavior:"submit",testID:"ParkingLoginFormReportCodeInputField"}),o.jsx(h,{hasClearButton:!1,keyboardType:"number-pad",label:"Pincode",name:"pin",onSubmitEditing:P,ref:e,rules:{required:"Vul een pincode in"},testID:"ParkingLoginFormPinCodeInputField"}),!w&&!!L&&o.jsxs(o.Fragment,{children:[o.jsx(_,{testID:"ParkingLoginFormSomethingWentWrong",text:T,title:"Inloggen mislukt"}),o.jsx(V,{height:"lg"})]}),o.jsx(b,{label:"Pincode vergeten",onPress:()=>m(y.requestPinCode),testID:"ParkingLoginForgotPinButton",variant:"tertiary"}),o.jsx(b,{disabled:r.formState.isSubmitting,label:"Inloggen",onPress:P,testID:"ParkingLoginFormSubmitButton"})]})})},Br={component:nt},d={};var C,I,F;d.parameters={...d.parameters,docs:{...(C=d.parameters)==null?void 0:C.docs,source:{originalSource:"{}",...(F=(I=d.parameters)==null?void 0:I.docs)==null?void 0:F.source}}};const Nr=["Default"];export{d as Default,Nr as __namedExportsOrder,Br as default};
