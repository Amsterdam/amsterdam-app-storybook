import{bC as O,r as l,bD as F,bE as R,a$ as v,bA as m,bF as B,b3 as K,bG as N,by as w,bH as V,bI as M,bJ as H,b8 as U,bK as k,b9 as J,bL as q,bM as z,o as G,j as s,b6 as Z,C,bd as I,e as $,bN as Q,n as W,aH as X,bO as Y,g as ee}from"./iframe-DUP_oGYL.js";import"./preload-helper-Dp1pzeXC.js";const te=e=>e===v.permitHolder?F.parkingPermitHolder:F.parkingVisitor,ne=()=>{const e=O();return l.useCallback(async(t,d)=>{const g=te(d);let r=[];try{const i=await R(g);if(i){let o;try{o=JSON.parse(i)}catch{o=[]}Array.isArray(o)&&(r=o.filter(a=>typeof a=="object"&&a!==null&&"reportCode"in a&&"pin"in a))}}catch{r=[]}r=r.filter(i=>i.reportCode!==t.reportCode),r.push(t),await e(g,JSON.stringify(r))},[e])},re=e=>{if(!e)return;const t="data"in e&&e.data&&typeof e.data=="object"&&"code"in e.data&&e.data.code;return t==="SSP_BAD_CREDENTIALS"?m.loginForbiddenFailed:t==="SSP_ACCOUNT_INACTIVE"?m.loginAccountInactiveFailed:t==="SSP_ACCOUNT_BLOCKED"?m.loginAccountBlockedFailed:m.loginFailed},ie=()=>{const e=B(),t=K({defaultValues:e}),d=l.useRef(null),{setAccessToken:g}=N(),{resetAlert:r,setAlert:i}=w(),o=V(),{openRedirect:a}=M(),{handleSubmit:j,setValue:f}=t,[T,{error:P,isError:S,isLoading:A}]=H(),_=ne(),c=U(),x=j(async({pin:n,reportCode:u})=>{try{const{access_token:p,access_token_expiration:D,scope:y}=await T({pin:n,report_code:u}).unwrap();await _({pin:n,reportCode:u},y),g(u,p,D),c(k.actions.setCurrentAccount(u)),c(k.actions.setCurrentPermitReportCode(void 0)),c(k.actions.setParkingAccount({reportCode:u,scope:y})),c(J.util.resetApiState()),c(q(!1))}catch(p){o(z.parkingLoginFailed,"ParkingLoginForm.tsx",{error:p}),G("ParkingLoginForm onSubmit error:",p)}});return l.useEffect(()=>{e&&(f("reportCode",e.reportCode),f("pin",e.pin))},[e,f]),l.useEffect(()=>{if(!S)return;const n=re(P);n&&i(n)},[S,P,i]),l.useEffect(()=>{A&&r()},[A,r]),s.jsx(Z,{...t,children:s.jsxs(C,{gutter:"xl",children:[s.jsxs(C,{gutter:"md",children:[s.jsx(I,{autoFocus:!0,hasClearButton:!1,keyboardType:"numbers-and-punctuation",label:"Meldcode",name:"reportCode",onSubmitEditing:()=>{var n;(n=d.current)==null||n.focus()},returnKeyType:$.OS==="android"?"done":void 0,rules:{required:"Vul een meldcode in"},submitBehavior:"submit",testID:"ParkingLoginFormReportCodeInputField",textTransform:n=>n.replaceAll(/[^a-zA-Z0-9]/g,"").toUpperCase()}),s.jsx(I,{fieldType:Q.pin,hasClearButton:!1,label:"Pincode",name:"pin",onSubmitEditing:x,ref:d,rules:{required:"Vul een pincode in"},testID:"ParkingLoginFormPinCodeInputField"}),s.jsxs(W,{children:["Meld- of pincode kwijt? U vindt ze in"," ",s.jsx(X,{isExternal:!0,"logging-label":"ParkingLoginFormInlineLink",onPress:()=>a(Y.my_parking),testID:"ParkingLoginFormInlineLink",children:"Mijn Parkeren"})]})]}),s.jsx(ee,{isLoading:t.formState.isSubmitting,label:"Inloggen",onPress:x,testID:"ParkingLoginFormSubmitButton"})]})})},ae={component:ie},b={};var L,E,h;b.parameters={...b.parameters,docs:{...(L=b.parameters)==null?void 0:L.docs,source:{originalSource:"{}",...(h=(E=b.parameters)==null?void 0:E.docs)==null?void 0:h.source}}};const ce=["Default"];export{b as Default,ce as __namedExportsOrder,ae as default};
