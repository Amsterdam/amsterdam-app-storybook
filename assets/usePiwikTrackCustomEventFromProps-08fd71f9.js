import{r as y}from"./index-76fb7be0.js";import{c as z,a as V,P as b,V as M,d as F,e as _}from"./version-bc6ab0e8.js";import"./redux-toolkit.esm-cb9067f1.js";import{c as $,e as j,a as N}from"./development-443ddb56.js";import{P as L,a as K,b as W,c as H,u as U,S as P,M as B,d as Q}from"./useSentry-f8932b7a.js";import{j as G}from"./index-9d7eb5a2.js";import{P as Y,N as O}from"./index-7ad04130.js";import{r as q}from"./index-467b4a8a.js";const D=z(),X=(t,e)=>!(e!=null&&e.id)&&typeof(e==null?void 0:e.id)!="number"?t:{...t,[V.contentId]:e.id.toString()},J=t=>{const e=(t==null?void 0:t.screenTitle)??(t==null?void 0:t.screenHeaderTitle);if(e)return decodeURIComponent(e)},Z=t=>{if(t)return Object.keys(t).filter(e=>t[e]!==void 0).reduce((e,n)=>({...e,[n]:t[n]}),{})},tt={[b.appVersion]:M,[b.appVersionWithBuild]:F},g=t=>Z({...t,...tt});function et(t){if(!Number.isInteger(t))throw new Error("Parameter must be an integer number")}function C(t){t&&Object.entries(t).forEach(e=>{let[n,c]=e;const i=parseInt(n,10);if(n!==i.toString())throw new Error("ID (key) must be an integer");if(i<1)throw new Error("ID (key) must be an integer greater than 0")})}function h(t){t.forEach(e=>{let n=e.customDimensions;if(n){if(Object.keys(n).length>20)throw new Error("Max 20 product custom dimensions, 20 is max ID.");C(n)}})}function nt(t){if(!/^[0-9a-f]{16}$/.test(t))throw new Error(`Visitor ID ${t} has invalid format. The format must match the regular expression: ^[0-9a-f]{16}$`)}const rt="1.1.0",it=`The package 'react-native-piwik-pro-sdk' doesn't seem to be linked. Make sure: 

`+Y.select({ios:`- You have run 'pod install'
`,default:""})+`- You rebuilt the app after installing the package
- You are not using Expo managed workflow
`,r=O.PiwikProSdk?O.PiwikProSdk:new Proxy({},{get(){throw new Error(it)}});async function at(t,e){return await r.init(t,e,rt)}async function ct(t,e){return s(e),await r.trackScreen(t,e)}async function st(t,e,n){return s(n),await r.trackCustomEvent(t,e,n)}async function ot(t,e){return s(e),await r.trackException(t,e)}async function ut(t,e,n){return s(n),await r.trackSocialInteraction(t,e,n)}async function mt(t,e){return s(e),await r.trackDownload(t,e)}async function lt(){return await r.trackApplicationInstall()}async function ft(t,e){return s(e),await r.trackOutlink(t,e)}async function dt(t,e){return s(e),await r.trackSearch(t,e)}async function kt(t,e){return s(e),await r.trackImpression(t,e)}async function wt(t,e,n){return s(n),await r.trackInteraction(t,e,n)}async function yt(t,e){return s(e),await r.trackGoal(t,e)}async function gt(t,e,n){return await r.trackEcommerce(t,e,n)}async function Pt(t,e){return s(e),h(t),await r.trackEcommerceProductDetailView(t,e)}async function It(t,e,n){return s(n),h(t),await r.trackEcommerceCartUpdate(t,e,n)}async function ht(t,e){return s(e),h(t),await r.trackEcommerceAddToCart(t,e)}async function Et(t,e){return s(e),h(t),await r.trackEcommerceRemoveFromCart(t,e)}async function vt(t,e,n,c){return s(c),h(n),await r.trackEcommerceOrder(t,e,n,c)}async function Ct(t){return await r.trackCampaign(t)}async function Dt(t){if(Array.isArray(t)){if(!t.length)throw new Error("Profile attributes cannot be an empty array");return await r.trackProfileAttributes(t)}return await r.trackProfileAttributes([t])}async function St(){return await r.getProfileAttributes()}async function _t(t){return await r.checkAudienceMembership(t)}async function bt(t){return await r.setUserId(t)}async function Ot(){return await r.getUserId()}async function Rt(t){return await r.setUserEmail(t)}async function pt(){return await r.getUserEmail()}async function Tt(t){return nt(t),await r.setVisitorId(t)}async function xt(){return await r.getVisitorId()}async function Vt(t){return await r.setSessionTimeout(t)}async function Nt(){return await r.getSessionTimeout()}async function Ut(){return await r.startNewSession()}async function At(){return await r.dispatch()}async function zt(t){return et(t),await r.setDispatchInterval(t)}async function Mt(){return await r.getDispatchInterval()}async function Ft(t){return await r.setIncludeDefaultCustomVariables(t)}async function $t(){return await r.getIncludeDefaultCustomVariables()}async function jt(t){return await r.setAnonymizationState(t)}async function Lt(){return await r.isAnonymizationOn()}async function Kt(t){return await r.setOptOut(t)}async function Wt(t){return await r.setDryRun(t)}async function Ht(){return await r.getDryRun()}async function Bt(){return await r.getOptOut()}async function Qt(t){return await r.setPrefixing(t)}async function Gt(){return await r.isPrefixingOn()}function s(t){C(t==null?void 0:t.customDimensions),C(t==null?void 0:t.visitCustomVariables),C(t==null?void 0:t.screenCustomVariables)}const I={init:at,trackScreen:ct,trackCustomEvent:st,trackException:ot,trackSocialInteraction:ut,trackDownload:mt,trackApplicationInstall:lt,trackOutlink:ft,trackSearch:dt,trackImpression:kt,trackInteraction:wt,trackGoal:yt,trackEcommerce:gt,trackEcommerceProductDetailView:Pt,trackEcommerceCartUpdate:It,trackEcommerceAddToCart:ht,trackEcommerceRemoveFromCart:Et,trackEcommerceOrder:vt,trackCampaign:Ct,trackProfileAttributes:Dt,getProfileAttributes:St,checkAudienceMembership:_t,setUserId:bt,getUserId:Ot,setUserEmail:Rt,getUserEmail:pt,setVisitorId:Tt,getVisitorId:xt,setSessionTimeout:Vt,getSessionTimeout:Nt,startNewSession:Ut,dispatch:At,setDispatchInterval:zt,getDispatchInterval:Mt,setIncludeDefaultCustomVariables:Ft,getIncludeDefaultCustomVariables:$t,setAnonymizationState:jt,isAnonymizationOn:Lt,setOptOut:Kt,getOptOut:Bt,setDryRun:Wt,getDryRun:Ht,setPrefixing:Qt,isPrefixingOn:Gt},[R,p]=$?[L,K]:[W,H],Yt=async()=>!R||!p?Promise.reject(_.missingEnvVars):(await I.init(R,p),await I.trackApplicationInstall(),await I.setIncludeDefaultCustomVariables(!0),Promise.resolve()),S=y.createContext(void 0),T=({children:t})=>{const{sendSentryErrorLog:e}=U(),[n,c]=y.useState();return y.useEffect(()=>{n===void 0&&Yt().then(()=>{c(I)}).catch(i=>{if(i.message===_.alreadyInitialized){c(I);return}c(null),i.message!==_.missingEnvVars&&e(P.piwikInitialization,"piwik.provider.tsx",{error:i})})},[n,e]),G.jsx(S.Provider,{value:n,children:t})};try{S.displayName="PiwikContext",S.__docgenInfo={description:"The PiwikContext contains the object with all methods, to be used via the usePiwik hook only.",displayName:"PiwikContext",props:{}}}catch{}try{T.displayName="PiwikProvider",T.__docgenInfo={description:"",displayName:"PiwikProvider",props:{}}}catch{}const qt=()=>{if(D.isReady()){const t=D.getRootState(),e=t==null?void 0:t.routes;if(e)for(let n=e.length-1;n>=0;n--){const c=B[e[n].name];if(c)return c}}};var x=q();const Xt=t=>{if(!t)return"";const e={};return Object.keys(x.parse(t)).forEach(n=>{e[n]="___"}),`?${x.stringify(e)}`},Jt=t=>t?`#${t.split("/").map(()=>"___").join("/")}`:"",Zt=(t="")=>{const[e,n,...c]=t.split("#"),[i,d,...k]=e.split("?");if(c.length||k.length)return i;const m=Xt(d),f=Jt(n);return`${i}${m}${f}`},E=()=>N("piwik not initialized"),te={ready:!1,trackCustomEvent:E,trackOutlink:E,trackScreen:E,trackSearch:E},v="usePiwik.ts",ee=({trackCustomEvent:t,trackOutlink:e,trackScreen:n,trackSearch:c},i,d,k,m,f)=>({ready:!0,trackCustomEvent:(o,a,u,l=d,w=void 0)=>{j("trackCustomEvent",{name:o,action:a,dimensions:u,category:l,value:w}),t(l,a,{path:m,customDimensions:g(u),value:w}).catch(()=>{i(P.piwikTrackCustomEvent,v,{category:l,action:a,name:o,path:m,value:w})})},trackOutlink:(o,a)=>{const u=Zt(o);e(u,{...a,customDimensions:g({...a==null?void 0:a.customDimensions,[V.routeName]:m})}).catch(()=>{i(P.piwikTrackOutlink,v,{url:u})})},trackScreen:(o,a)=>{const u=o??m;if(!u)return;const l=X(a==null?void 0:a.customDimensions,f);n(u,{...a,title:J(f),customDimensions:g(l)}).catch(()=>{i(P.piwikTrackScreen,v,{path:o})}),k.trackPageView({name:u},g(l))},trackSearch:(o,a)=>{c(o,{...a,customDimensions:g(a==null?void 0:a.customDimensions)}).catch(()=>{i(P.piwikTrackSearch,v)})}}),ne=()=>{const t=y.useContext(S),{sendSentryErrorLog:e}=U(),n=D.isReady()?D.getCurrentRoute():void 0,c=qt()??"general",i=Q();return y.useMemo(()=>t?ee(t,e,c,i,n==null?void 0:n.name,n==null?void 0:n.params):te,[t,e,c,i,n==null?void 0:n.name,n==null?void 0:n.params])},re=t=>{const e=t.logName??t["sentry-label"]??t.testID;return e||N("No name found in props"),e},fe=({logAction:t,logCategory:e,logDimensions:n={},logValue:c,onEvent:i,testID:d,logName:k,"sentry-label":m})=>{const{trackCustomEvent:f}=ne();return y.useCallback((o,{nameSuffix:a,dimensions:u={},action:l=t}={})=>{i==null||i(o);const w=re({testID:d,logName:k,"sentry-label":m});if(w){const A=a?`:${a}`:"";f(`${w}${A}`,l,{...n,...u},e,c)}},[t,e,n,k,c,i,m,d,f])};export{ne as a,qt as g,x as l,fe as u};
