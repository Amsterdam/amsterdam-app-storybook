import{r as f}from"./index-76fb7be0.js";import{c as p,a as V,P as O,V as M,d as F,e as S,M as K}from"./slugs-b43e7e98.js";import"./redux-toolkit.esm-cb9067f1.js";import{e as L,c as j,d as N}from"./development-de2bc6fd.js";import{u as U,S as d,b as z}from"./useSentry-3517252a.js";import{j as W}from"./index-9d7eb5a2.js";import{P as $}from"./invariant-f1a82cf7.js";import{N as b}from"./index-fb7b51b4.js";const C=p(),B=(t,e)=>!(e!=null&&e.id)&&typeof(e==null?void 0:e.id)!="number"?t:{...t,[V.contentId]:e.id.toString()},G=t=>{const e=(t==null?void 0:t.screenTitle)??(t==null?void 0:t.screenHeaderTitle);if(e)return decodeURIComponent(e)},Y=t=>{if(t)return Object.keys(t).filter(e=>t[e]!==void 0).reduce((e,n)=>({...e,[n]:t[n]}),{})},H={[O.appVersion]:M,[O.appVersionWithBuild]:F},g=t=>Y({...t,...H});function X(t){if(!Number.isInteger(t))throw new Error("Parameter must be an integer number")}function v(t){t&&Object.entries(t).forEach(e=>{let[n,a]=e;const c=parseInt(n,10);if(n!==c.toString())throw new Error("ID (key) must be an integer");if(c<1)throw new Error("ID (key) must be an integer greater than 0")})}function P(t){t.forEach(e=>{let n=e.customDimensions;if(n){if(Object.keys(n).length>20)throw new Error("Max 20 product custom dimensions, 20 is max ID.");v(n)}})}function q(t){if(!/^[0-9a-f]{16}$/.test(t))throw new Error(`Visitor ID ${t} has invalid format. The format must match the regular expression: ^[0-9a-f]{16}$`)}const J="1.1.0",Q=`The package 'react-native-piwik-pro-sdk' doesn't seem to be linked. Make sure: 

`+$.select({ios:`- You have run 'pod install'
`,default:""})+`- You rebuilt the app after installing the package
- You are not using Expo managed workflow
`,r=b.PiwikProSdk?b.PiwikProSdk:new Proxy({},{get(){throw new Error(Q)}});async function Z(t,e){return await r.init(t,e,J)}async function tt(t,e){return s(e),await r.trackScreen(t,e)}async function et(t,e,n){return s(n),await r.trackCustomEvent(t,e,n)}async function nt(t,e){return s(e),await r.trackException(t,e)}async function rt(t,e,n){return s(n),await r.trackSocialInteraction(t,e,n)}async function it(t,e){return s(e),await r.trackDownload(t,e)}async function at(){return await r.trackApplicationInstall()}async function ct(t,e){return s(e),await r.trackOutlink(t,e)}async function st(t,e){return s(e),await r.trackSearch(t,e)}async function ot(t,e){return s(e),await r.trackImpression(t,e)}async function ut(t,e,n){return s(n),await r.trackInteraction(t,e,n)}async function mt(t,e){return s(e),await r.trackGoal(t,e)}async function lt(t,e,n){return await r.trackEcommerce(t,e,n)}async function ft(t,e){return s(e),P(t),await r.trackEcommerceProductDetailView(t,e)}async function kt(t,e,n){return s(n),P(t),await r.trackEcommerceCartUpdate(t,e,n)}async function wt(t,e){return s(e),P(t),await r.trackEcommerceAddToCart(t,e)}async function dt(t,e){return s(e),P(t),await r.trackEcommerceRemoveFromCart(t,e)}async function yt(t,e,n,a){return s(a),P(n),await r.trackEcommerceOrder(t,e,n,a)}async function Pt(t){return await r.trackCampaign(t)}async function It(t){if(Array.isArray(t)){if(!t.length)throw new Error("Profile attributes cannot be an empty array");return await r.trackProfileAttributes(t)}return await r.trackProfileAttributes([t])}async function gt(){return await r.getProfileAttributes()}async function Et(t){return await r.checkAudienceMembership(t)}async function ht(t){return await r.setUserId(t)}async function vt(){return await r.getUserId()}async function Ct(t){return await r.setUserEmail(t)}async function Dt(){return await r.getUserEmail()}async function St(t){return q(t),await r.setVisitorId(t)}async function _t(){return await r.getVisitorId()}async function Ot(t){return await r.setSessionTimeout(t)}async function bt(){return await r.getSessionTimeout()}async function Rt(){return await r.startNewSession()}async function Tt(){return await r.dispatch()}async function xt(t){return X(t),await r.setDispatchInterval(t)}async function Vt(){return await r.getDispatchInterval()}async function Nt(t){return await r.setIncludeDefaultCustomVariables(t)}async function Ut(){return await r.getIncludeDefaultCustomVariables()}async function At(t){return await r.setAnonymizationState(t)}async function pt(){return await r.isAnonymizationOn()}async function Mt(t){return await r.setOptOut(t)}async function Ft(t){return await r.setDryRun(t)}async function Kt(){return await r.getDryRun()}async function Lt(){return await r.getOptOut()}async function jt(t){return await r.setPrefixing(t)}async function zt(){return await r.isPrefixingOn()}function s(t){v(t==null?void 0:t.customDimensions),v(t==null?void 0:t.visitCustomVariables),v(t==null?void 0:t.screenCustomVariables)}const y={init:Z,trackScreen:tt,trackCustomEvent:et,trackException:nt,trackSocialInteraction:rt,trackDownload:it,trackApplicationInstall:at,trackOutlink:ct,trackSearch:st,trackImpression:ot,trackInteraction:ut,trackGoal:mt,trackEcommerce:lt,trackEcommerceProductDetailView:ft,trackEcommerceCartUpdate:kt,trackEcommerceAddToCart:wt,trackEcommerceRemoveFromCart:dt,trackEcommerceOrder:yt,trackCampaign:Pt,trackProfileAttributes:It,getProfileAttributes:gt,checkAudienceMembership:Et,setUserId:ht,getUserId:vt,setUserEmail:Ct,getUserEmail:Dt,setVisitorId:St,getVisitorId:_t,setSessionTimeout:Ot,getSessionTimeout:bt,startNewSession:Rt,dispatch:Tt,setDispatchInterval:xt,getDispatchInterval:Vt,setIncludeDefaultCustomVariables:Nt,getIncludeDefaultCustomVariables:Ut,setAnonymizationState:At,isAnonymizationOn:pt,setOptOut:Mt,getOptOut:Lt,setDryRun:Ft,getDryRun:Kt,setPrefixing:jt,isPrefixingOn:zt},Wt="",$t="",Bt="",Gt="",[R,T]=L?[Wt,$t]:[Bt,Gt],Yt=async()=>!R||!T?Promise.reject(S.missingEnvVars):(await y.init(R,T),await y.trackApplicationInstall(),await y.setIncludeDefaultCustomVariables(!0),Promise.resolve()),D=f.createContext(void 0),x=({children:t})=>{const{sendSentryErrorLog:e}=U(),[n,a]=f.useState();return f.useEffect(()=>{n===void 0&&Yt().then(()=>{a(y)}).catch(c=>{if(c.message===S.alreadyInitialized){a(y);return}a(null),c.message!==S.missingEnvVars&&e(d.piwikInitialization,"piwik.provider.tsx",{error:c})})},[n,e]),W.jsx(D.Provider,{value:n,children:t})};try{D.displayName="PiwikContext",D.__docgenInfo={description:"The PiwikContext contains the object with all methods, to be used via the usePiwik hook only.",displayName:"PiwikContext",props:{}}}catch{}try{x.displayName="PiwikProvider",x.__docgenInfo={description:"",displayName:"PiwikProvider",props:{}}}catch{}const Ht=()=>{if(C.isReady()){const t=C.getRootState(),e=t==null?void 0:t.routes;if(e)for(let n=e.length-1;n>=0;n--){const a=K[e[n].name];if(a)return a}}},E=()=>N("piwik not initialized"),Xt={ready:!1,trackCustomEvent:E,trackOutlink:E,trackScreen:E,trackSearch:E},h="usePiwik.ts",qt=({trackCustomEvent:t,trackOutlink:e,trackScreen:n,trackSearch:a},c,I,m,k)=>({ready:!0,trackCustomEvent:(o,i,u,l=I,w=void 0)=>{j("trackCustomEvent",{name:o,action:i,dimensions:u,category:l,value:w}),t(l,i,{path:m,customDimensions:g(u),value:w}).catch(()=>{c(d.piwikTrackCustomEvent,h,{category:l,action:i,name:o,path:m,value:w})})},trackOutlink:(o,i)=>{const u=z(o);e(u,{...i,customDimensions:g({...i==null?void 0:i.customDimensions,[V.routeName]:m})}).catch(()=>{c(d.piwikTrackOutlink,h,{url:u})})},trackScreen:(o,i)=>{const u=o??m;if(!u)return;const l=B(i==null?void 0:i.customDimensions,k);n(u,{...i,title:G(k),customDimensions:g(l)}).catch(()=>{c(d.piwikTrackScreen,h,{path:o})})},trackSearch:(o,i)=>{a(o,{...i,customDimensions:g(i==null?void 0:i.customDimensions)}).catch(()=>{c(d.piwikTrackSearch,h)})}}),Jt=()=>{const t=f.useContext(D),{sendSentryErrorLog:e}=U(),n=C.isReady()?C.getCurrentRoute():void 0,a=Ht()??"general";return f.useMemo(()=>t?qt(t,e,a,n==null?void 0:n.name,n==null?void 0:n.params):Xt,[t,e,a,n==null?void 0:n.name,n==null?void 0:n.params])},Qt=t=>{const e=t.logName??t["sentry-label"]??t.testID;return e||N("No name found in props"),e},se=({logAction:t,logCategory:e,logDimensions:n={},logValue:a,onEvent:c,testID:I,logName:m,"sentry-label":k})=>{const{trackCustomEvent:o}=Jt();return f.useCallback((i,{nameSuffix:u,dimensions:l={},action:w=t}={})=>{c==null||c(i);const _=Qt({testID:I,logName:m,"sentry-label":k});if(_){const A=u?`:${u}`:"";o(`${_}${A}`,w,{...n,...l},e,a)}},[t,e,n,m,a,c,k,I,o])};export{Jt as a,Ht as g,se as u};
