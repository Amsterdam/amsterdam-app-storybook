import{r as d}from"./index-76fb7be0.js";import{c as M,P as D,V as $,d as j,a as S,e as C}from"./version-ba873cb0.js";import"./index-e8e5dbb3.js";import{a as w,P as F,c as K,d as L,f as W,u as A,M as H,h as B}from"./useTrackException-84f7968f.js";import{a as U,c as Q}from"./development-f8096310.js";import{r as G}from"./index-3ba17d29.js";import{j as Y}from"./jsx-runtime-ffb262ed.js";import{P as q,N as b}from"./index-ac976766.js";const I=M(),J=t=>{if(t)return Object.keys(t).filter(e=>t[e]!==void 0).reduce((e,n)=>({...e,[n]:t[n]}),{})},X={[D.appVersion]:$,[D.appVersionWithBuild]:j},Z=(t,e=!1)=>e?Object.keys(t).reduce((n,i)=>{const a=D[i]??S[i];return a&&(n[a]=t[i]),n},{}):t,l=(t,e=!1)=>J(Z({...X,...t},e)),tt=t=>{const e={};return(typeof(t==null?void 0:t.id)=="string"||typeof(t==null?void 0:t.id)=="number")&&(e[S.contentId]=t.id.toString()),{appInsights:l(e,!0),piwik:l(e,!1)}},O=t=>{const e=(t==null?void 0:t.screenTitle)??(t==null?void 0:t.screenHeaderTitle);if(e)return decodeURIComponent(e)};var R=G();const et=t=>{if(!t)return"";const e={};return Object.keys(R.parse(t)).forEach(n=>{e[n]="___"}),`?${R.stringify(e)}`},nt=t=>t?`#${t.split("/").map(()=>"___").join("/")}`:"",rt=(t="")=>{const[e,n,...i]=t.split("#"),[a,m,...o]=e.split("?");if(i.length||o.length)return a;const c=et(m),u=nt(n);return`${a}${c}${u}`},P=()=>U("piwik not initialized"),h="useTrackEvents.ts",it=(t,e,n,i,a,m)=>({ready:!!i,trackCustomEvent:(o,c,u,f=e,k=void 0)=>{i?i.trackCustomEvent(f,c,{path:a,customDimensions:l(u),value:k}).catch(()=>{t(w.piwikTrackCustomEvent,h,{category:f,action:c,name:o,routeName:a,value:k})}):P(),n.trackEvent({name:c,properties:{...l(u,!0),value:k,routeName:a,category:f}})},trackOutlink:(o,c)=>{const u=rt(o);i?i.trackOutlink(u,{...c,customDimensions:l({...c==null?void 0:c.customDimensions,[S.routeName]:a})}).catch(()=>{t(w.piwikTrackOutlink,h,{url:u})}):P(),n.trackEvent({name:"outlink",properties:{...l(c==null?void 0:c.customDimensions,!0),url:u,routeName:a,category:e}})},trackScreen:o=>{const c=o??a;if(!c)return;const{appInsights:u,piwik:f}=tt(m);i?i.trackScreen(c,{title:O(m),customDimensions:f}).catch(()=>{t(w.piwikTrackScreen,h,{path:o})}):P(),n.trackPageView({name:c},{...u,title:O(m)})},trackSearch:(o,c)=>{i?i.trackSearch(o,{...c,customDimensions:l(c==null?void 0:c.customDimensions)}).catch(()=>{t(w.piwikTrackSearch,h)}):P(),n.trackEvent({name:"search",properties:{...l(c==null?void 0:c.customDimensions,!0),keyword:o,routeName:a,category:e}})}});function at(t){if(!Number.isInteger(t))throw new Error("Parameter must be an integer number")}function E(t){t&&Object.entries(t).forEach(e=>{let[n,i]=e;const a=parseInt(n,10);if(n!==a.toString())throw new Error("ID (key) must be an integer");if(a<1)throw new Error("ID (key) must be an integer greater than 0")})}function g(t){t.forEach(e=>{let n=e.customDimensions;if(n){if(Object.keys(n).length>20)throw new Error("Max 20 product custom dimensions, 20 is max ID.");E(n)}})}function ct(t){if(!/^[0-9a-f]{16}$/.test(t))throw new Error(`Visitor ID ${t} has invalid format. The format must match the regular expression: ^[0-9a-f]{16}$`)}const st="1.1.0",ot=`The package 'react-native-piwik-pro-sdk' doesn't seem to be linked. Make sure: 

`+q.select({ios:`- You have run 'pod install'
`,default:""})+`- You rebuilt the app after installing the package
- You are not using Expo managed workflow
`,r=b.PiwikProSdk?b.PiwikProSdk:new Proxy({},{get(){throw new Error(ot)}});async function ut(t,e){return await r.init(t,e,st)}async function mt(t,e){return s(e),await r.trackScreen(t,e)}async function lt(t,e,n){return s(n),await r.trackCustomEvent(t,e,n)}async function ft(t,e){return s(e),await r.trackException(t,e)}async function kt(t,e,n){return s(n),await r.trackSocialInteraction(t,e,n)}async function dt(t,e){return s(e),await r.trackDownload(t,e)}async function wt(){return await r.trackApplicationInstall()}async function yt(t,e){return s(e),await r.trackOutlink(t,e)}async function gt(t,e){return s(e),await r.trackSearch(t,e)}async function Pt(t,e){return s(e),await r.trackImpression(t,e)}async function ht(t,e,n){return s(n),await r.trackInteraction(t,e,n)}async function Et(t,e){return s(e),await r.trackGoal(t,e)}async function It(t,e,n){return await r.trackEcommerce(t,e,n)}async function vt(t,e){return s(e),g(t),await r.trackEcommerceProductDetailView(t,e)}async function Dt(t,e,n){return s(n),g(t),await r.trackEcommerceCartUpdate(t,e,n)}async function Ct(t,e){return s(e),g(t),await r.trackEcommerceAddToCart(t,e)}async function St(t,e){return s(e),g(t),await r.trackEcommerceRemoveFromCart(t,e)}async function _t(t,e,n,i){return s(i),g(n),await r.trackEcommerceOrder(t,e,n,i)}async function bt(t){return await r.trackCampaign(t)}async function Ot(t){if(Array.isArray(t)){if(!t.length)throw new Error("Profile attributes cannot be an empty array");return await r.trackProfileAttributes(t)}return await r.trackProfileAttributes([t])}async function Rt(){return await r.getProfileAttributes()}async function xt(t){return await r.checkAudienceMembership(t)}async function Tt(t){return await r.setUserId(t)}async function Vt(){return await r.getUserId()}async function At(t){return await r.setUserEmail(t)}async function Ut(){return await r.getUserEmail()}async function pt(t){return ct(t),await r.setVisitorId(t)}async function Nt(){return await r.getVisitorId()}async function zt(t){return await r.setSessionTimeout(t)}async function Mt(){return await r.getSessionTimeout()}async function $t(){return await r.startNewSession()}async function jt(){return await r.dispatch()}async function Ft(t){return at(t),await r.setDispatchInterval(t)}async function Kt(){return await r.getDispatchInterval()}async function Lt(t){return await r.setIncludeDefaultCustomVariables(t)}async function Wt(){return await r.getIncludeDefaultCustomVariables()}async function Ht(t){return await r.setAnonymizationState(t)}async function Bt(){return await r.isAnonymizationOn()}async function Qt(t){return await r.setOptOut(t)}async function Gt(t){return await r.setDryRun(t)}async function Yt(){return await r.getDryRun()}async function qt(){return await r.getOptOut()}async function Jt(t){return await r.setPrefixing(t)}async function Xt(){return await r.isPrefixingOn()}function s(t){E(t==null?void 0:t.customDimensions),E(t==null?void 0:t.visitCustomVariables),E(t==null?void 0:t.screenCustomVariables)}const y={init:ut,trackScreen:mt,trackCustomEvent:lt,trackException:ft,trackSocialInteraction:kt,trackDownload:dt,trackApplicationInstall:wt,trackOutlink:yt,trackSearch:gt,trackImpression:Pt,trackInteraction:ht,trackGoal:Et,trackEcommerce:It,trackEcommerceProductDetailView:vt,trackEcommerceCartUpdate:Dt,trackEcommerceAddToCart:Ct,trackEcommerceRemoveFromCart:St,trackEcommerceOrder:_t,trackCampaign:bt,trackProfileAttributes:Ot,getProfileAttributes:Rt,checkAudienceMembership:xt,setUserId:Tt,getUserId:Vt,setUserEmail:At,getUserEmail:Ut,setVisitorId:pt,getVisitorId:Nt,setSessionTimeout:zt,getSessionTimeout:Mt,startNewSession:$t,dispatch:jt,setDispatchInterval:Ft,getDispatchInterval:Kt,setIncludeDefaultCustomVariables:Lt,getIncludeDefaultCustomVariables:Wt,setAnonymizationState:Ht,isAnonymizationOn:Bt,setOptOut:Qt,getOptOut:qt,setDryRun:Gt,getDryRun:Yt,setPrefixing:Jt,isPrefixingOn:Xt},[x,T]=Q?[F,K]:[L,W],Zt=async()=>!x||!T?Promise.reject(C.missingEnvVars):(await y.init(x,T),await y.trackApplicationInstall(),await y.setIncludeDefaultCustomVariables(!0),Promise.resolve()),v=d.createContext(void 0),V=({children:t})=>{const e=A(),[n,i]=d.useState();return d.useEffect(()=>{n===void 0&&Zt().then(()=>{i(y)}).catch(a=>{if(a.message===C.alreadyInitialized){i(y);return}i(null),a.message!==C.missingEnvVars&&e(w.piwikInitialization,"piwik.provider.tsx",{error:a})})},[n,e]),Y.jsx(v.Provider,{value:n,children:t})};try{v.displayName="PiwikContext",v.__docgenInfo={description:"The PiwikContext contains the object with all methods, to be used via the usePiwik hook only.",displayName:"PiwikContext",props:{}}}catch{}try{V.displayName="PiwikProvider",V.__docgenInfo={description:"",displayName:"PiwikProvider",props:{}}}catch{}const te=()=>{if(I.isReady()){const t=I.getRootState(),e=t==null?void 0:t.routes;if(e)for(let n=e.length-1;n>=0;n--){const i=H[e[n].name];if(i)return i}}},ee=()=>{const t=d.useContext(v),e=I.isReady()?I.getCurrentRoute():void 0,n=te()??"general",i=B(),a=A();return d.useMemo(()=>it(a,n,i,t,e==null?void 0:e.name,e==null?void 0:e.params),[t,a,n,i,e==null?void 0:e.name,e==null?void 0:e.params])},ne=t=>{const e=t.logName??t["logging-label"]??t.testID;return e||U("No name found in props"),e},le=({logAction:t,logCategory:e,logDimensions:n={},logValue:i,onEvent:a,testID:m,logName:o,"logging-label":c})=>{const{trackCustomEvent:u}=ee();return d.useCallback((f,{nameSuffix:k,dimensions:p={},action:N=t}={})=>{a==null||a(f);const _=ne({testID:m,logName:o,"logging-label":c});if(_){const z=k?`:${k}`:"";u(`${_}${z}`,N,{...n,...p},e,i)}},[t,e,n,o,i,a,c,m,u])};export{ee as a,te as g,R as l,le as u};
