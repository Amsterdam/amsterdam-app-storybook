import{aY as B,r as p,aZ as F,a_ as R,a9 as V,a$ as O,ae as w,b0 as K,aJ as N,b1 as M,b2 as U,b3 as J,aa as q,b4 as b,ab as z,b5 as H,b6 as Z,ao as Y,j as i,af as $,o as C,ad as I,s as G,aF as Q,b as W,b7 as X,b8 as ee,B as te}from"./iframe-BjxVA3BW.js";import{u as ne}from"./useCurrentParkingApiVersion-g3DBXqFP.js";import{a as m}from"./alerts-DAM_oyOM.js";import"./preload-helper-Dp1pzeXC.js";const re=e=>e===V.permitHolder?F.parkingPermitHolder:F.parkingVisitor,ae=()=>{const e=B();return p.useCallback(async(t,c)=>{const u=re(c);let r=[];try{const a=await R(u);if(a){let s;try{s=JSON.parse(a)}catch{s=[]}Array.isArray(s)&&(r=s.filter(o=>typeof o=="object"&&o!==null&&"reportCode"in o&&"pin"in o))}}catch{r=[]}r=r.filter(a=>a.reportCode!==t.reportCode),r.push(t),await e(u,JSON.stringify(r))},[e])},ie=e=>{if(!e)return;const t="data"in e&&e.data&&typeof e.data=="object"&&"code"in e.data&&e.data.code;return t==="SSP_BAD_CREDENTIALS"?m.loginForbiddenFailed:t==="SSP_ACCOUNT_INACTIVE"?m.loginAccountInactiveFailed:t==="SSP_ACCOUNT_BLOCKED"?m.loginAccountBlockedFailed:m.loginFailed},se=()=>{const e=ne(),t=O(),c=w({defaultValues:t}),u=p.useRef(null),{setAccessToken:r}=K(),{resetAlert:a,setAlert:s}=N(),o=M(),{openRedirect:j}=U(),{handleSubmit:_,setValue:f}=c,[T,{error:P,isError:A,isLoading:S}]=J(),D=ae(),l=q(),x=_(async({pin:n,reportCode:d})=>{try{const{access_token:g,access_token_expiration:v,scope:y}=await T({pin:n,report_code:d}).unwrap();await D({pin:n,reportCode:d},y),r(d,g,v),l(b.actions.setCurrentAccount(d)),l(b.actions.setCurrentPermitReportCode(void 0)),l(b.actions.setParkingAccount({reportCode:d,scope:y})),l(z.util.resetApiState()),l(H(!1))}catch(g){o(Z.parkingLoginFailed,"ParkingLoginForm.tsx",{error:g}),Y("ParkingLoginForm onSubmit error:",g)}});return p.useEffect(()=>{t&&(f("reportCode",t.reportCode),f("pin",t.pin))},[t,f]),p.useEffect(()=>{if(!A)return;const n=ie(P);n&&s(n)},[A,P,s]),p.useEffect(()=>{S&&a()},[S,a]),i.jsx($,{...c,children:i.jsxs(C,{gutter:"xl",children:[i.jsxs(C,{gutter:"md",children:[i.jsx(I,{autoFocus:!0,hasClearButton:!1,keyboardType:e===Q.v1?"number-pad":"numbers-and-punctuation",label:"Meldcode",name:"reportCode",onSubmitEditing:()=>{var n;(n=u.current)==null||n.focus()},returnKeyType:G.OS==="android"?"done":void 0,rules:{required:"Vul een meldcode in"},submitBehavior:"submit",testID:"ParkingLoginFormReportCodeInputField",textTransform:n=>n.replaceAll(/[^a-zA-Z0-9]/g,"").toUpperCase()}),i.jsx(I,{hasClearButton:!1,keyboardType:"number-pad",label:"Pincode",name:"pin",onSubmitEditing:x,ref:u,rules:{required:"Vul een pincode in"},testID:"ParkingLoginFormPinCodeInputField"}),i.jsxs(W,{children:["Meld- of pincode kwijt? U vindt ze in"," ",i.jsx(X,{isExternal:!0,"logging-label":"ParkingLoginFormInlineLink",onPress:()=>j(ee.my_parking),testID:"ParkingLoginFormInlineLink",children:"Mijn Parkeren"})]})]}),i.jsx(te,{isLoading:c.formState.isSubmitting,label:"Inloggen",onPress:x,testID:"ParkingLoginFormSubmitButton"})]})})},de={component:se},k={};var L,E,h;k.parameters={...k.parameters,docs:{...(L=k.parameters)==null?void 0:L.docs,source:{originalSource:"{}",...(h=(E=k.parameters)==null?void 0:E.docs)==null?void 0:h.source}}};const pe=["Default"];export{k as Default,pe as __namedExportsOrder,de as default};
