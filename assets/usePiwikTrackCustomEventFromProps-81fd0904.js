import{r as f}from"./index-76fb7be0.js";import{c as M,P as D,V as $,d as j,a as S,e as C}from"./version-f0b2d5d4.js";import"./index-e8e5dbb3.js";import{a as k,P as F,c as K,d as L,f as W,u as V,M as H,h as B}from"./useTrackException-7e906e11.js";import{a as A,c as Q}from"./development-bf3bfac5.js";import{r as G}from"./index-3ba17d29.js";import{j as Y}from"./jsx-runtime-ffb262ed.js";import{P as q,N as b}from"./index-ee31bd24.js";const E=M(),J=t=>{if(t)return Object.keys(t).filter(e=>t[e]!==void 0).reduce((e,n)=>({...e,[n]:t[n]}),{})},X={[D.appVersion]:$,[D.appVersionWithBuild]:j},Z=(t,e=!1)=>e?Object.keys(t).reduce((n,i)=>{const a=D[i]??S[i];return a&&(n[a]=t[i]),n},{}):t,w=(t,e=!1)=>J(Z({...X,...t},e)),tt=t=>{const e={};return(typeof(t==null?void 0:t.id)=="string"||typeof(t==null?void 0:t.id)=="number")&&(e[S.contentId]=t.id.toString()),{appInsights:w(e,!0),piwik:w(e,!1)}},O=t=>{const e=(t==null?void 0:t.screenTitle)??(t==null?void 0:t.screenHeaderTitle);if(e)return decodeURIComponent(e)};var p=G();const et=t=>{if(!t)return"";const e={};return Object.keys(p.parse(t)).forEach(n=>{e[n]="___"}),`?${p.stringify(e)}`},nt=t=>t?`#${t.split("/").map(()=>"___").join("/")}`:"",rt=(t="")=>{const[e,n,...i]=t.split("#"),[a,m,...o]=e.split("?");if(i.length||o.length)return a;const c=et(m),u=nt(n);return`${a}${c}${u}`},P=()=>A("piwik not initialized"),h="useTrackEvents.ts",it=(t,e,n,i,a,m)=>({ready:!!i,trackCustomEvent:(o,c,u,l=e,d=void 0)=>{i?i.trackCustomEvent(l,c,{path:a,customDimensions:w(u),value:d}).catch(()=>{t(k.piwikTrackCustomEvent,h,{category:l,action:c,name:o,path:a,value:d})}):P()},trackOutlink:(o,c)=>{const u=rt(o);i?i.trackOutlink(u,{...c,customDimensions:w({...c==null?void 0:c.customDimensions,[S.routeName]:a})}).catch(()=>{t(k.piwikTrackOutlink,h,{url:u})}):P()},trackScreen:o=>{const c=o??a;if(!c)return;const{appInsights:u,piwik:l}=tt(m);i?i.trackScreen(c,{title:O(m),customDimensions:l}).catch(()=>{t(k.piwikTrackScreen,h,{path:o})}):P(),n.trackPageView({name:c},{...u,title:O(m)})},trackSearch:(o,c)=>{i?i.trackSearch(o,{...c,customDimensions:w(c==null?void 0:c.customDimensions)}).catch(()=>{t(k.piwikTrackSearch,h)}):P()}});function at(t){if(!Number.isInteger(t))throw new Error("Parameter must be an integer number")}function I(t){t&&Object.entries(t).forEach(e=>{let[n,i]=e;const a=parseInt(n,10);if(n!==a.toString())throw new Error("ID (key) must be an integer");if(a<1)throw new Error("ID (key) must be an integer greater than 0")})}function y(t){t.forEach(e=>{let n=e.customDimensions;if(n){if(Object.keys(n).length>20)throw new Error("Max 20 product custom dimensions, 20 is max ID.");I(n)}})}function ct(t){if(!/^[0-9a-f]{16}$/.test(t))throw new Error(`Visitor ID ${t} has invalid format. The format must match the regular expression: ^[0-9a-f]{16}$`)}const st="1.1.0",ot=`The package 'react-native-piwik-pro-sdk' doesn't seem to be linked. Make sure: 

`+q.select({ios:`- You have run 'pod install'
`,default:""})+`- You rebuilt the app after installing the package
- You are not using Expo managed workflow
`,r=b.PiwikProSdk?b.PiwikProSdk:new Proxy({},{get(){throw new Error(ot)}});async function ut(t,e){return await r.init(t,e,st)}async function mt(t,e){return s(e),await r.trackScreen(t,e)}async function lt(t,e,n){return s(n),await r.trackCustomEvent(t,e,n)}async function ft(t,e){return s(e),await r.trackException(t,e)}async function dt(t,e,n){return s(n),await r.trackSocialInteraction(t,e,n)}async function kt(t,e){return s(e),await r.trackDownload(t,e)}async function wt(){return await r.trackApplicationInstall()}async function gt(t,e){return s(e),await r.trackOutlink(t,e)}async function yt(t,e){return s(e),await r.trackSearch(t,e)}async function Pt(t,e){return s(e),await r.trackImpression(t,e)}async function ht(t,e,n){return s(n),await r.trackInteraction(t,e,n)}async function It(t,e){return s(e),await r.trackGoal(t,e)}async function Et(t,e,n){return await r.trackEcommerce(t,e,n)}async function vt(t,e){return s(e),y(t),await r.trackEcommerceProductDetailView(t,e)}async function Dt(t,e,n){return s(n),y(t),await r.trackEcommerceCartUpdate(t,e,n)}async function Ct(t,e){return s(e),y(t),await r.trackEcommerceAddToCart(t,e)}async function St(t,e){return s(e),y(t),await r.trackEcommerceRemoveFromCart(t,e)}async function _t(t,e,n,i){return s(i),y(n),await r.trackEcommerceOrder(t,e,n,i)}async function bt(t){return await r.trackCampaign(t)}async function Ot(t){if(Array.isArray(t)){if(!t.length)throw new Error("Profile attributes cannot be an empty array");return await r.trackProfileAttributes(t)}return await r.trackProfileAttributes([t])}async function pt(){return await r.getProfileAttributes()}async function Rt(t){return await r.checkAudienceMembership(t)}async function xt(t){return await r.setUserId(t)}async function Tt(){return await r.getUserId()}async function Vt(t){return await r.setUserEmail(t)}async function At(){return await r.getUserEmail()}async function Nt(t){return ct(t),await r.setVisitorId(t)}async function Ut(){return await r.getVisitorId()}async function zt(t){return await r.setSessionTimeout(t)}async function Mt(){return await r.getSessionTimeout()}async function $t(){return await r.startNewSession()}async function jt(){return await r.dispatch()}async function Ft(t){return at(t),await r.setDispatchInterval(t)}async function Kt(){return await r.getDispatchInterval()}async function Lt(t){return await r.setIncludeDefaultCustomVariables(t)}async function Wt(){return await r.getIncludeDefaultCustomVariables()}async function Ht(t){return await r.setAnonymizationState(t)}async function Bt(){return await r.isAnonymizationOn()}async function Qt(t){return await r.setOptOut(t)}async function Gt(t){return await r.setDryRun(t)}async function Yt(){return await r.getDryRun()}async function qt(){return await r.getOptOut()}async function Jt(t){return await r.setPrefixing(t)}async function Xt(){return await r.isPrefixingOn()}function s(t){I(t==null?void 0:t.customDimensions),I(t==null?void 0:t.visitCustomVariables),I(t==null?void 0:t.screenCustomVariables)}const g={init:ut,trackScreen:mt,trackCustomEvent:lt,trackException:ft,trackSocialInteraction:dt,trackDownload:kt,trackApplicationInstall:wt,trackOutlink:gt,trackSearch:yt,trackImpression:Pt,trackInteraction:ht,trackGoal:It,trackEcommerce:Et,trackEcommerceProductDetailView:vt,trackEcommerceCartUpdate:Dt,trackEcommerceAddToCart:Ct,trackEcommerceRemoveFromCart:St,trackEcommerceOrder:_t,trackCampaign:bt,trackProfileAttributes:Ot,getProfileAttributes:pt,checkAudienceMembership:Rt,setUserId:xt,getUserId:Tt,setUserEmail:Vt,getUserEmail:At,setVisitorId:Nt,getVisitorId:Ut,setSessionTimeout:zt,getSessionTimeout:Mt,startNewSession:$t,dispatch:jt,setDispatchInterval:Ft,getDispatchInterval:Kt,setIncludeDefaultCustomVariables:Lt,getIncludeDefaultCustomVariables:Wt,setAnonymizationState:Ht,isAnonymizationOn:Bt,setOptOut:Qt,getOptOut:qt,setDryRun:Gt,getDryRun:Yt,setPrefixing:Jt,isPrefixingOn:Xt},[R,x]=Q?[F,K]:[L,W],Zt=async()=>!R||!x?Promise.reject(C.missingEnvVars):(await g.init(R,x),await g.trackApplicationInstall(),await g.setIncludeDefaultCustomVariables(!0),Promise.resolve()),v=f.createContext(void 0),T=({children:t})=>{const e=V(),[n,i]=f.useState();return f.useEffect(()=>{n===void 0&&Zt().then(()=>{i(g)}).catch(a=>{if(a.message===C.alreadyInitialized){i(g);return}i(null),a.message!==C.missingEnvVars&&e(k.piwikInitialization,"piwik.provider.tsx",{error:a})})},[n,e]),Y.jsx(v.Provider,{value:n,children:t})};try{v.displayName="PiwikContext",v.__docgenInfo={description:"The PiwikContext contains the object with all methods, to be used via the usePiwik hook only.",displayName:"PiwikContext",props:{}}}catch{}try{T.displayName="PiwikProvider",T.__docgenInfo={description:"",displayName:"PiwikProvider",props:{}}}catch{}const te=()=>{if(E.isReady()){const t=E.getRootState(),e=t==null?void 0:t.routes;if(e)for(let n=e.length-1;n>=0;n--){const i=H[e[n].name];if(i)return i}}},ee=()=>{const t=f.useContext(v),e=E.isReady()?E.getCurrentRoute():void 0,n=te()??"general",i=B(),a=V();return f.useMemo(()=>it(a,n,i,t,e==null?void 0:e.name,e==null?void 0:e.params),[t,a,n,i,e==null?void 0:e.name,e==null?void 0:e.params])},ne=t=>{const e=t.logName??t["logging-label"]??t.testID;return e||A("No name found in props"),e},le=({logAction:t,logCategory:e,logDimensions:n={},logValue:i,onEvent:a,testID:m,logName:o,"logging-label":c})=>{const{trackCustomEvent:u}=ee();return f.useCallback((l,{nameSuffix:d,dimensions:N={},action:U=t}={})=>{a==null||a(l);const _=ne({testID:m,logName:o,"logging-label":c});if(_){const z=d?`:${d}`:"";u(`${_}${z}`,U,{...n,...N},e,i)}},[t,e,n,o,i,a,c,m,u])};export{ee as a,te as g,p as l,le as u};
