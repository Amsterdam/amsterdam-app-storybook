import{r as l}from"./index-76fb7be0.js";import{c as p,a as N,b as O,V as M,d as F,e as S,f as K,g as L,h as z,i as j,M as W}from"./slugs-8fd1a178.js";import"./redux-toolkit.esm-d86c6d3e.js";import{b as $,a as B,d as x}from"./development-fba0c344.js";import{u as A}from"./useSentry-eca49495.js";import{j as G}from"./index-1401012c.js";import{P as Y}from"./invariant-f1a82cf7.js";import{N as b}from"./index-14cede91.js";import{S as d,s as H}from"./logging-a19d7dfe.js";const D=p(),X=(t,e)=>!(e!=null&&e.id)&&typeof(e==null?void 0:e.id)!="number"?t:{...t,[N.contentId]:e.id.toString()},q=t=>(t==null?void 0:t.screenTitle)??(t==null?void 0:t.screenHeaderTitle),J=t=>{if(t)return Object.keys(t).filter(e=>t[e]!==void 0).reduce((e,n)=>({...e,[n]:t[n]}),{})},Q={[O.appVersion]:M,[O.appVersionWithBuild]:F},I=t=>J({...t,...Q});function Z(t){if(!Number.isInteger(t))throw new Error("Parameter must be an integer number")}function v(t){t&&Object.entries(t).forEach(e=>{let[n,i]=e;const c=parseInt(n,10);if(n!==c.toString())throw new Error("ID (key) must be an integer");if(c<1)throw new Error("ID (key) must be an integer greater than 0")})}function P(t){t.forEach(e=>{let n=e.customDimensions;if(n){if(Object.keys(n).length>20)throw new Error("Max 20 product custom dimensions, 20 is max ID.");v(n)}})}function tt(t){if(!/^[0-9a-f]{16}$/.test(t))throw new Error(`Visitor ID ${t} has invalid format. The format must match the regular expression: ^[0-9a-f]{16}$`)}const et="1.1.0",nt=`The package 'react-native-piwik-pro-sdk' doesn't seem to be linked. Make sure: 

`+Y.select({ios:`- You have run 'pod install'
`,default:""})+`- You rebuilt the app after installing the package
- You are not using Expo managed workflow
`,r=b.PiwikProSdk?b.PiwikProSdk:new Proxy({},{get(){throw new Error(nt)}});async function rt(t,e){return await r.init(t,e,et)}async function at(t,e){return s(e),await r.trackScreen(t,e)}async function it(t,e,n){return s(n),await r.trackCustomEvent(t,e,n)}async function ct(t,e){return s(e),await r.trackException(t,e)}async function st(t,e,n){return s(n),await r.trackSocialInteraction(t,e,n)}async function ot(t,e){return s(e),await r.trackDownload(t,e)}async function ut(){return await r.trackApplicationInstall()}async function mt(t,e){return s(e),await r.trackOutlink(t,e)}async function ft(t,e){return s(e),await r.trackSearch(t,e)}async function lt(t,e){return s(e),await r.trackImpression(t,e)}async function kt(t,e,n){return s(n),await r.trackInteraction(t,e,n)}async function wt(t,e){return s(e),await r.trackGoal(t,e)}async function dt(t,e,n){return await r.trackEcommerce(t,e,n)}async function yt(t,e){return s(e),P(t),await r.trackEcommerceProductDetailView(t,e)}async function Pt(t,e,n){return s(n),P(t),await r.trackEcommerceCartUpdate(t,e,n)}async function gt(t,e){return s(e),P(t),await r.trackEcommerceAddToCart(t,e)}async function It(t,e){return s(e),P(t),await r.trackEcommerceRemoveFromCart(t,e)}async function ht(t,e,n,i){return s(i),P(n),await r.trackEcommerceOrder(t,e,n,i)}async function Et(t){return await r.trackCampaign(t)}async function vt(t){if(Array.isArray(t)){if(!t.length)throw new Error("Profile attributes cannot be an empty array");return await r.trackProfileAttributes(t)}return await r.trackProfileAttributes([t])}async function Dt(){return await r.getProfileAttributes()}async function Ct(t){return await r.checkAudienceMembership(t)}async function St(t){return await r.setUserId(t)}async function _t(){return await r.getUserId()}async function Ot(t){return await r.setUserEmail(t)}async function bt(){return await r.getUserEmail()}async function Rt(t){return tt(t),await r.setVisitorId(t)}async function Tt(){return await r.getVisitorId()}async function Vt(t){return await r.setSessionTimeout(t)}async function Nt(){return await r.getSessionTimeout()}async function xt(){return await r.startNewSession()}async function At(){return await r.dispatch()}async function Ut(t){return Z(t),await r.setDispatchInterval(t)}async function pt(){return await r.getDispatchInterval()}async function Mt(t){return await r.setIncludeDefaultCustomVariables(t)}async function Ft(){return await r.getIncludeDefaultCustomVariables()}async function Kt(t){return await r.setAnonymizationState(t)}async function Lt(){return await r.isAnonymizationOn()}async function zt(t){return await r.setOptOut(t)}async function jt(t){return await r.setDryRun(t)}async function Wt(){return await r.getDryRun()}async function $t(){return await r.getOptOut()}async function Bt(t){return await r.setPrefixing(t)}async function Gt(){return await r.isPrefixingOn()}function s(t){v(t==null?void 0:t.customDimensions),v(t==null?void 0:t.visitCustomVariables),v(t==null?void 0:t.screenCustomVariables)}const y={init:rt,trackScreen:at,trackCustomEvent:it,trackException:ct,trackSocialInteraction:st,trackDownload:ot,trackApplicationInstall:ut,trackOutlink:mt,trackSearch:ft,trackImpression:lt,trackInteraction:kt,trackGoal:wt,trackEcommerce:dt,trackEcommerceProductDetailView:yt,trackEcommerceCartUpdate:Pt,trackEcommerceAddToCart:gt,trackEcommerceRemoveFromCart:It,trackEcommerceOrder:ht,trackCampaign:Et,trackProfileAttributes:vt,getProfileAttributes:Dt,checkAudienceMembership:Ct,setUserId:St,getUserId:_t,setUserEmail:Ot,getUserEmail:bt,setVisitorId:Rt,getVisitorId:Tt,setSessionTimeout:Vt,getSessionTimeout:Nt,startNewSession:xt,dispatch:At,setDispatchInterval:Ut,getDispatchInterval:pt,setIncludeDefaultCustomVariables:Mt,getIncludeDefaultCustomVariables:Ft,setAnonymizationState:Kt,isAnonymizationOn:Lt,setOptOut:zt,getOptOut:$t,setDryRun:jt,getDryRun:Wt,setPrefixing:Bt,isPrefixingOn:Gt},[R,T]=$?[K,L]:[z,j],Yt=async()=>!R||!T?Promise.reject(S.missingEnvVars):(await y.init(R,T),await y.trackApplicationInstall(),await y.setIncludeDefaultCustomVariables(!0),Promise.resolve()),C=l.createContext(void 0),V=({children:t})=>{const{sendSentryErrorLog:e}=A(),[n,i]=l.useState();return l.useEffect(()=>{n===void 0&&Yt().then(()=>{i(y)}).catch(c=>{if(c.message===S.alreadyInitialized){i(y);return}i(null),c.message!==S.missingEnvVars&&e(d.piwikInitialization,"piwik.provider.tsx",{error:c})})},[n,e]),G(C.Provider,{value:n,children:t})};try{C.displayName="PiwikContext",C.__docgenInfo={description:"The PiwikContext contains the object with all methods, to be used via the usePiwik hook only.",displayName:"PiwikContext",props:{}}}catch{}try{V.displayName="PiwikProvider",V.__docgenInfo={description:"",displayName:"PiwikProvider",props:{}}}catch{}const Ht=()=>{if(D.isReady()){const t=D.getRootState(),e=t==null?void 0:t.routes;if(e)for(let n=e.length-1;n>=0;n--){const i=W[e[n].name];if(i)return i}}},h=()=>x("piwik not initialized"),Xt={ready:!1,trackCustomEvent:h,trackOutlink:h,trackScreen:h,trackSearch:h},E="usePiwik.ts",qt=({trackCustomEvent:t,trackOutlink:e,trackScreen:n,trackSearch:i},c,g,m,k)=>({ready:!0,trackCustomEvent:(o,a,u,f=g,w=void 0)=>{B("trackCustomEvent",{name:o,action:a,dimensions:u,category:f,value:w}),t(f,a,{path:m,customDimensions:I(u),value:w}).catch(()=>{c(d.piwikTrackCustomEvent,E,{category:f,action:a,name:o,path:m,value:w})})},trackOutlink:(o,a)=>{const u=H(o);e(u,{...a,customDimensions:I({...a==null?void 0:a.customDimensions,[N.routeName]:m})}).catch(()=>{c(d.piwikTrackOutlink,E,{url:u})})},trackScreen:(o,a)=>{const u=o??m;if(!u)return;const f=X(a==null?void 0:a.customDimensions,k);n(u,{...a,title:q(k),customDimensions:I(f)}).catch(()=>{c(d.piwikTrackScreen,E,{path:o})})},trackSearch:(o,a)=>{i(o,{...a,customDimensions:I(a==null?void 0:a.customDimensions)}).catch(()=>{c(d.piwikTrackSearch,E)})}}),Jt=()=>{const t=l.useContext(C),{sendSentryErrorLog:e}=A(),n=D.isReady()?D.getCurrentRoute():void 0,i=Ht()??"general";return l.useMemo(()=>t?qt(t,e,i,n==null?void 0:n.name,n==null?void 0:n.params):Xt,[t,e,i,n==null?void 0:n.name,n==null?void 0:n.params])},Qt=t=>{const e=t.logName??t["sentry-label"]??t.testID;return e||x("No name found in props"),e},oe=({logAction:t,logCategory:e,logDimensions:n={},logValue:i,onEvent:c,testID:g,logName:m,"sentry-label":k})=>{const{trackCustomEvent:o}=Jt();return l.useCallback((a,{nameSuffix:u,dimensions:f={},action:w=t}={})=>{c==null||c(a);const _=Qt({testID:g,logName:m,"sentry-label":k});if(_){const U=u?`:${u}`:"";o(`${_}${U}`,w,{...n,...f},e,i)}},[t,e,n,m,i,c,k,g,o])};export{Jt as a,Ht as g,oe as u};
