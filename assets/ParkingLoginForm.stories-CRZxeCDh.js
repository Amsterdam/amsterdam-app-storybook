import{aK as V,r as p,aL as C,aM as v,a4 as B,aN as O,aO as w,aw as K,aP as N,aQ as M,aR as U,a5 as q,aS as P,a6 as z,aT as H,aU as J,aV as Q,j as i,C as F,m as W,at as X,b as Z,aW as G,aX as Y,B as $}from"./iframe-6xDbxYjz.js";import{u as ee,F as te}from"./index.esm-C_Txkf9B.js";import{T as I}from"./TextInputField-Ctnjj37L.js";import{u as re}from"./useCurrentParkingApiVersion-BXeD1xAa.js";import{a as m}from"./alerts-CfInWgaO.js";import"./preload-helper-Dp1pzeXC.js";import"./CharactersLeftDisplay-Cmc2RBYj.js";import"./TextInput-XgTdxEFG.js";import"./index-BKYa5qnl.js";import"./gestureObjects-BGzWLZRC.js";import"./Label-DztVXOdk.js";import"./useAccessibilityAnnounce-DFtN3rX9.js";const ne=e=>e===B.permitHolder?C.parkingPermitHolder:C.parkingVisitor,ae=()=>{const e=V();return p.useCallback(async(t,c)=>{const u=ne(c);let n=[];try{const a=await v(u);if(a){let o;try{o=JSON.parse(a)}catch{o=[]}Array.isArray(o)&&(n=o.filter(s=>typeof s=="object"&&s!==null&&"reportCode"in s&&"pin"in s))}}catch{n=[]}n=n.filter(a=>a.reportCode!==t.reportCode),n.push(t),await e(u,JSON.stringify(n))},[e])},ie=e=>{if(!e)return;const t="data"in e&&e.data&&typeof e.data=="object"&&"code"in e.data&&e.data.code;return t==="SSP_BAD_CREDENTIALS"?m.loginForbiddenFailed:t==="SSP_ACCOUNT_INACTIVE"?m.loginAccountInactiveFailed:t==="SSP_ACCOUNT_BLOCKED"?m.loginAccountBlockedFailed:m.loginFailed},oe=()=>{const e=re(),t=O(),c=ee({defaultValues:t}),u=p.useRef(null),{setAccessToken:n}=w(),{resetAlert:a,setAlert:o}=K(),s=N(),{openRedirect:j}=M(),{handleSubmit:T,setValue:k}=c,[_,{error:S,isError:A,isLoading:b}]=U(),D=ae(),l=q(),x=T(async({pin:r,reportCode:d})=>{try{const{access_token:g,access_token_expiration:R,scope:y}=await _({pin:r,report_code:d}).unwrap();await D({pin:r,reportCode:d},y),n(d,g,R),l(P.actions.setCurrentAccount(d)),l(P.actions.setCurrentPermitReportCode(void 0)),l(P.actions.setParkingAccount({reportCode:d,scope:y})),l(z.util.resetApiState()),l(H(!1))}catch(g){s(J.parkingLoginFailed,"ParkingLoginForm.tsx",{error:g}),Q("ParkingLoginForm onSubmit error:",g)}});return p.useEffect(()=>{t&&(k("reportCode",t.reportCode),k("pin",t.pin))},[t,k]),p.useEffect(()=>{if(!A)return;const r=ie(S);r&&o(r)},[A,S,o]),p.useEffect(()=>{b&&a()},[b,a]),i.jsx(te,{...c,children:i.jsxs(F,{gutter:"xl",children:[i.jsxs(F,{gutter:"md",children:[i.jsx(I,{autoFocus:!0,hasClearButton:!1,keyboardType:e===X.v1?"number-pad":"numbers-and-punctuation",label:"Meldcode",name:"reportCode",onSubmitEditing:()=>{var r;(r=u.current)==null||r.focus()},returnKeyType:W.OS==="android"?"done":void 0,rules:{required:"Vul een meldcode in"},submitBehavior:"submit",testID:"ParkingLoginFormReportCodeInputField",textTransform:r=>r.replaceAll(/[^a-zA-Z0-9]/g,"").toUpperCase()}),i.jsx(I,{hasClearButton:!1,keyboardType:"number-pad",label:"Pincode",name:"pin",onSubmitEditing:x,ref:u,rules:{required:"Vul een pincode in"},testID:"ParkingLoginFormPinCodeInputField"}),i.jsxs(Z,{children:["Meld- of pincode kwijt? U vindt ze in"," ",i.jsx(G,{external:!0,"logging-label":"ParkingLoginFormInlineLink",onPress:()=>j(Y.my_parking),testID:"ParkingLoginFormInlineLink",children:"Mijn Parkeren"})]})]}),i.jsx($,{isLoading:c.formState.isSubmitting,label:"Inloggen",onPress:x,testID:"ParkingLoginFormSubmitButton"})]})})},Ae={component:oe},f={};var L,E,h;f.parameters={...f.parameters,docs:{...(L=f.parameters)==null?void 0:L.docs,source:{originalSource:"{}",...(h=(E=f.parameters)==null?void 0:E.docs)==null?void 0:h.source}}};const be=["Default"];export{f as Default,be as __namedExportsOrder,Ae as default};
