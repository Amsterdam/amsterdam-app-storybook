import{j as t}from"./jsx-runtime-DNHyKP0h.js";import{r as l}from"./index-B-xgG2PE.js";import{u as w,F as T}from"./index.esm-DMWELHmA.js";import{B as b}from"./Button-BfrLntof.js";import{S as B}from"./SomethingWentWrong-BsaCIp9m.js";import{T as h}from"./TextInputField-Bioc-I-c.js";import{C as R}from"./Column-BVTjdkRj.js";import{G as _}from"./Gutter-DZNZA9AL.js";import{u as V}from"./useNavigation-BdRzcVWJ.js";import{u as N}from"./useDispatch-jiStvVFn.js";import{d as O,e as W,S as I,g as q,f as K,p as G}from"./service-B54VJsLA.js";import{a as H}from"./types-C2OYdTo_.js";import{P as J}from"./routes-CtH9nUKh.js";import{b as M,c as U,p as k,d as z}from"./slice-j3ipSnyk.js";import{d as Q}from"./useTrackException-BuwXEiys.js";import{P as X}from"./index-BiinuClr.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./PressableBase-CjF7xowT.js";import"./usePiwikTrackCustomEventFromProps-CxPttqNH.js";import"./index-CnyDuYXe.js";import"./index-aqbATsDD.js";import"./NativeEventEmitter-CjF4_R2K.js";import"./TextAncestorContext-Z5dgoe9Q.js";import"./index-Cm4QxXoK.js";import"./index-BogbXpcI.js";import"./extends-CF3RwP-h.js";import"./index-DoMT7H_C.js";import"./config-BZnShabN.js";import"./Row-BWITOpr7.js";import"./mapCrossAxisAlignment-DpnuLLqj.js";import"./mapMainAxisAlignment-BOa0GzUh.js";import"./useThemable-DhqiuDXa.js";import"./index-DICU_UuR.js";import"./index-CGHx0_JJ.js";import"./base-color-BCCzFoQm.js";import"./Icon-BzuqpaND.js";import"./index-s4hYfBOP.js";import"./index-Chjiymov.js";import"./Animated-45BN0duk.js";import"./index-DoCTQWjN.js";import"./index-u-pG-eXf.js";import"./index-CXGG-aYW.js";import"./types-CttlCamk.js";import"./useDeviceContext-BsghPmC5.js";import"./index-C70cEofB.js";import"./useTheme-6yZg5PNu.js";import"./AccessibleText-ySoCsV7u.js";import"./Pressable-D3po4rrg.js";import"./Box-DtUcsZz-.js";import"./layoutStyles-Beptdp9x.js";import"./Alert.types-B-Yctuek.js";import"./AlertBase-bwoP-HEs.js";import"./SingleSelectable-UeAGsyNp.js";import"./Paragraph-D7hi8caX.js";import"./Title-Ob0ruCyA.js";import"./useAccessibilityFocus-Caw8Leih.js";import"./index-TB2J_fWb.js";import"./index-996-O__M.js";import"./useIsScreenReaderEnabled-CpYBVHk9.js";import"./duration-BV61i-wJ.js";import"./accessibleText-gmNPjmn1.js";import"./useAccessibilityAnnounce-64AxzTCn.js";import"./CharactersLeftDisplay-D9CbJUqK.js";import"./TextInput-C1qTl2Jd.js";import"./IconButton-CZ-k5fg7.js";import"./Badge-BdgnIhUJ.js";import"./formatNumber-BOnMa6yj.js";import"./Label-BmtnxIPR.js";import"./Phrase-fCMNBH1z.js";import"./index-shQJSbQb.js";import"./dayjs-C6sMkNK9.js";import"./index-D8IHtqZ9.js";import"./client-Ci5f1cWN.js";import"./index-DKdc_Qc3.js";import"./index-DeJff1tQ.js";import"./index-sQd6WMHM.js";import"./index-C8evIbG0.js";import"./index-Cy9gAJ_F.js";import"./index-DWP-9n27.js";import"./index-oz3Z5D95.js";import"./iframe-8wlgjD0D.js";const Y=()=>{const{setItem:r}=O();return l.useCallback((n,o)=>W(n,o).then(()=>{r(n)}),[r])},Z=r=>r===H.permitHolder?I.parkingPermitHolder:I.parkingVisitor,$=()=>{const r=Y();return l.useCallback(async(n,o)=>{const m=Z(o);let e=[];try{const s=await q(m);if(s){let a;try{a=JSON.parse(s)}catch{a=[]}Array.isArray(a)&&(e=a.filter(i=>typeof i=="object"&&i!==null&&"reportCode"in i&&"pin"in i))}}catch{e=[]}e=e.filter(s=>s.reportCode!==n.reportCode),e.push(n),await r(m,JSON.stringify(e))},[r])},tt=()=>{const r=V(),{navigate:n}=r,o=M(),m=w({defaultValues:o}),e=l.useRef(null),{setAccessToken:s}=U(),{handleSubmit:a,setValue:i}=m,[C,{error:g,isError:A,isLoading:j}]=K(),v=g&&"status"in g&&g.status===403,E=$(),p=N(),L=v?"Controleer uw meldcode en pincode en probeer het opnieuw.":"Er is iets misgegaan. Probeer het opnieuw.",P=a(async({pin:c,reportCode:u})=>{try{const{access_token:f,access_token_expiration:D,scope:S}=await C({pin:c,report_code:u}).unwrap();await E({pin:c,reportCode:u},S),s(u,f,D),p(k.actions.setCurrentAccount(u)),p(k.actions.setCurrentPermitReportCode(void 0)),p(k.actions.setParkingAccount({reportCode:u,scope:S})),p(G.util.resetApiState()),p(z(!1))}catch(f){Q("ParkingLoginForm onSubmit error:",f)}});return l.useEffect(()=>{o&&(i("reportCode",o.reportCode),i("pin",o.pin))},[o,i]),t.jsx(T,{...m,children:t.jsxs(R,{gutter:"md",children:[t.jsx(h,{autoFocus:!0,hasClearButton:!1,keyboardType:"number-pad",label:"Meldcode",name:"reportCode",onSubmitEditing:()=>{var c;(c=e.current)==null||c.focus()},returnKeyType:X.OS!=="ios"?"done":void 0,rules:{required:"Vul een meldcode in"},submitBehavior:"submit",testID:"ParkingLoginFormReportCodeInputField"}),t.jsx(h,{hasClearButton:!1,keyboardType:"number-pad",label:"Pincode",name:"pin",onSubmitEditing:P,ref:e,rules:{required:"Vul een pincode in"},testID:"ParkingLoginFormPinCodeInputField"}),!j&&!!A&&t.jsxs(t.Fragment,{children:[t.jsx(B,{testID:"ParkingLoginFormSomethingWentWrong",text:L,title:"Inloggen mislukt"}),t.jsx(_,{height:"lg"})]}),t.jsx(b,{label:"Pincode vergeten",onPress:()=>n(J.requestPinCode),testID:"ParkingLoginForgotPinButton",variant:"tertiary"}),t.jsx(b,{disabled:m.formState.isSubmitting,label:"Inloggen",onPress:P,testID:"ParkingLoginFormSubmitButton"})]})})},vr={component:tt},d={};var x,y,F;d.parameters={...d.parameters,docs:{...(x=d.parameters)==null?void 0:x.docs,source:{originalSource:"{}",...(F=(y=d.parameters)==null?void 0:y.docs)==null?void 0:F.source}}};const Er=["Default"];export{d as Default,Er as __namedExportsOrder,vr as default};
