import{r as f}from"./index-76fb7be0.js";import{c as z,a as C,P as D,V as M,d as $,e as S}from"./version-2c32a6bc.js";import"./redux-toolkit.esm-5225e422.js";import{a as V,c as j}from"./development-3a32c91f.js";import{S as w,P as F,a as K,b as L,c as W,u as N,M as H,d as B}from"./useSentry-cd9ebf7f.js";import{r as Q}from"./index-3ba17d29.js";import{j as G}from"./jsx-runtime-ffb262ed.js";import{P as Y,N as b}from"./index-ee31bd24.js";const I=z(),q=(t,e)=>!(e!=null&&e.id)&&typeof(e==null?void 0:e.id)!="number"?t:{...t,[C.contentId]:e.id.toString()},J=t=>{if(t)return Object.keys(t).filter(e=>t[e]!==void 0).reduce((e,n)=>({...e,[n]:t[n]}),{})},X={[D.appVersion]:M,[D.appVersionWithBuild]:$},Z=(t,e=!1)=>e?Object.keys(t).reduce((n,a)=>{const i=D[a]??C[a];return i&&(n[i]=t[a]),n},{}):t,k=(t,e=!1)=>J(Z({...X,...t},e)),tt=t=>{const e=(t==null?void 0:t.screenTitle)??(t==null?void 0:t.screenHeaderTitle);if(e)return decodeURIComponent(e)};var O=Q();const et=t=>{if(!t)return"";const e={};return Object.keys(O.parse(t)).forEach(n=>{e[n]="___"}),`?${O.stringify(e)}`},nt=t=>t?`#${t.split("/").map(()=>"___").join("/")}`:"",rt=(t="")=>{const[e,n,...a]=t.split("#"),[i,m,...o]=e.split("?");if(a.length||o.length)return i;const c=et(m),u=nt(n);return`${i}${c}${u}`},P=()=>V("piwik not initialized"),h="useTrackEvents.ts",at=(t,e,n,a,i,m)=>({ready:!!a,trackCustomEvent:(o,c,u,l=e,d=void 0)=>{a?a.trackCustomEvent(l,c,{path:i,customDimensions:k(u),value:d}).catch(()=>{t(w.piwikTrackCustomEvent,h,{category:l,action:c,name:o,path:i,value:d})}):P()},trackOutlink:(o,c)=>{const u=rt(o);a?a.trackOutlink(u,{...c,customDimensions:k({...c==null?void 0:c.customDimensions,[C.routeName]:i})}).catch(()=>{t(w.piwikTrackOutlink,h,{url:u})}):P()},trackScreen:(o,c)=>{const u=o??i;if(!u)return;const l=q(c==null?void 0:c.customDimensions,m);a?a.trackScreen(u,{...c,title:tt(m),customDimensions:k(l)}).catch(()=>{t(w.piwikTrackScreen,h,{path:o})}):P(),n.trackPageView({name:u},k(l,!0))},trackSearch:(o,c)=>{a?a.trackSearch(o,{...c,customDimensions:k(c==null?void 0:c.customDimensions)}).catch(()=>{t(w.piwikTrackSearch,h)}):P()}});function it(t){if(!Number.isInteger(t))throw new Error("Parameter must be an integer number")}function E(t){t&&Object.entries(t).forEach(e=>{let[n,a]=e;const i=parseInt(n,10);if(n!==i.toString())throw new Error("ID (key) must be an integer");if(i<1)throw new Error("ID (key) must be an integer greater than 0")})}function g(t){t.forEach(e=>{let n=e.customDimensions;if(n){if(Object.keys(n).length>20)throw new Error("Max 20 product custom dimensions, 20 is max ID.");E(n)}})}function ct(t){if(!/^[0-9a-f]{16}$/.test(t))throw new Error(`Visitor ID ${t} has invalid format. The format must match the regular expression: ^[0-9a-f]{16}$`)}const st="1.1.0",ot=`The package 'react-native-piwik-pro-sdk' doesn't seem to be linked. Make sure: 

`+Y.select({ios:`- You have run 'pod install'
`,default:""})+`- You rebuilt the app after installing the package
- You are not using Expo managed workflow
`,r=b.PiwikProSdk?b.PiwikProSdk:new Proxy({},{get(){throw new Error(ot)}});async function ut(t,e){return await r.init(t,e,st)}async function mt(t,e){return s(e),await r.trackScreen(t,e)}async function lt(t,e,n){return s(n),await r.trackCustomEvent(t,e,n)}async function ft(t,e){return s(e),await r.trackException(t,e)}async function dt(t,e,n){return s(n),await r.trackSocialInteraction(t,e,n)}async function kt(t,e){return s(e),await r.trackDownload(t,e)}async function wt(){return await r.trackApplicationInstall()}async function yt(t,e){return s(e),await r.trackOutlink(t,e)}async function gt(t,e){return s(e),await r.trackSearch(t,e)}async function Pt(t,e){return s(e),await r.trackImpression(t,e)}async function ht(t,e,n){return s(n),await r.trackInteraction(t,e,n)}async function Et(t,e){return s(e),await r.trackGoal(t,e)}async function It(t,e,n){return await r.trackEcommerce(t,e,n)}async function vt(t,e){return s(e),g(t),await r.trackEcommerceProductDetailView(t,e)}async function Dt(t,e,n){return s(n),g(t),await r.trackEcommerceCartUpdate(t,e,n)}async function St(t,e){return s(e),g(t),await r.trackEcommerceAddToCart(t,e)}async function Ct(t,e){return s(e),g(t),await r.trackEcommerceRemoveFromCart(t,e)}async function _t(t,e,n,a){return s(a),g(n),await r.trackEcommerceOrder(t,e,n,a)}async function bt(t){return await r.trackCampaign(t)}async function Ot(t){if(Array.isArray(t)){if(!t.length)throw new Error("Profile attributes cannot be an empty array");return await r.trackProfileAttributes(t)}return await r.trackProfileAttributes([t])}async function Rt(){return await r.getProfileAttributes()}async function Tt(t){return await r.checkAudienceMembership(t)}async function xt(t){return await r.setUserId(t)}async function Vt(){return await r.getUserId()}async function Nt(t){return await r.setUserEmail(t)}async function Ut(){return await r.getUserEmail()}async function At(t){return ct(t),await r.setVisitorId(t)}async function pt(){return await r.getVisitorId()}async function zt(t){return await r.setSessionTimeout(t)}async function Mt(){return await r.getSessionTimeout()}async function $t(){return await r.startNewSession()}async function jt(){return await r.dispatch()}async function Ft(t){return it(t),await r.setDispatchInterval(t)}async function Kt(){return await r.getDispatchInterval()}async function Lt(t){return await r.setIncludeDefaultCustomVariables(t)}async function Wt(){return await r.getIncludeDefaultCustomVariables()}async function Ht(t){return await r.setAnonymizationState(t)}async function Bt(){return await r.isAnonymizationOn()}async function Qt(t){return await r.setOptOut(t)}async function Gt(t){return await r.setDryRun(t)}async function Yt(){return await r.getDryRun()}async function qt(){return await r.getOptOut()}async function Jt(t){return await r.setPrefixing(t)}async function Xt(){return await r.isPrefixingOn()}function s(t){E(t==null?void 0:t.customDimensions),E(t==null?void 0:t.visitCustomVariables),E(t==null?void 0:t.screenCustomVariables)}const y={init:ut,trackScreen:mt,trackCustomEvent:lt,trackException:ft,trackSocialInteraction:dt,trackDownload:kt,trackApplicationInstall:wt,trackOutlink:yt,trackSearch:gt,trackImpression:Pt,trackInteraction:ht,trackGoal:Et,trackEcommerce:It,trackEcommerceProductDetailView:vt,trackEcommerceCartUpdate:Dt,trackEcommerceAddToCart:St,trackEcommerceRemoveFromCart:Ct,trackEcommerceOrder:_t,trackCampaign:bt,trackProfileAttributes:Ot,getProfileAttributes:Rt,checkAudienceMembership:Tt,setUserId:xt,getUserId:Vt,setUserEmail:Nt,getUserEmail:Ut,setVisitorId:At,getVisitorId:pt,setSessionTimeout:zt,getSessionTimeout:Mt,startNewSession:$t,dispatch:jt,setDispatchInterval:Ft,getDispatchInterval:Kt,setIncludeDefaultCustomVariables:Lt,getIncludeDefaultCustomVariables:Wt,setAnonymizationState:Ht,isAnonymizationOn:Bt,setOptOut:Qt,getOptOut:qt,setDryRun:Gt,getDryRun:Yt,setPrefixing:Jt,isPrefixingOn:Xt},[R,T]=j?[F,K]:[L,W],Zt=async()=>!R||!T?Promise.reject(S.missingEnvVars):(await y.init(R,T),await y.trackApplicationInstall(),await y.setIncludeDefaultCustomVariables(!0),Promise.resolve()),v=f.createContext(void 0),x=({children:t})=>{const{sendSentryErrorLog:e}=N(),[n,a]=f.useState();return f.useEffect(()=>{n===void 0&&Zt().then(()=>{a(y)}).catch(i=>{if(i.message===S.alreadyInitialized){a(y);return}a(null),i.message!==S.missingEnvVars&&e(w.piwikInitialization,"piwik.provider.tsx",{error:i})})},[n,e]),G.jsx(v.Provider,{value:n,children:t})};try{v.displayName="PiwikContext",v.__docgenInfo={description:"The PiwikContext contains the object with all methods, to be used via the usePiwik hook only.",displayName:"PiwikContext",props:{}}}catch{}try{x.displayName="PiwikProvider",x.__docgenInfo={description:"",displayName:"PiwikProvider",props:{}}}catch{}const te=()=>{if(I.isReady()){const t=I.getRootState(),e=t==null?void 0:t.routes;if(e)for(let n=e.length-1;n>=0;n--){const a=H[e[n].name];if(a)return a}}},ee=()=>{const t=f.useContext(v),{sendSentryErrorLog:e}=N(),n=I.isReady()?I.getCurrentRoute():void 0,a=te()??"general",i=B();return f.useMemo(()=>at(e,a,i,t,n==null?void 0:n.name,n==null?void 0:n.params),[t,e,a,i,n==null?void 0:n.name,n==null?void 0:n.params])},ne=t=>{const e=t.logName??t["sentry-label"]??t.testID;return e||V("No name found in props"),e},le=({logAction:t,logCategory:e,logDimensions:n={},logValue:a,onEvent:i,testID:m,logName:o,"sentry-label":c})=>{const{trackCustomEvent:u}=ee();return f.useCallback((l,{nameSuffix:d,dimensions:U={},action:A=t}={})=>{i==null||i(l);const _=ne({testID:m,logName:o,"sentry-label":c});if(_){const p=d?`:${d}`:"";u(`${_}${p}`,A,{...n,...U},e,a)}},[t,e,n,o,a,i,c,m,u])};export{ee as a,te as g,O as l,le as u};
