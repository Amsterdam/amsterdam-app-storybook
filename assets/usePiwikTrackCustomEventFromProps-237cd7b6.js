import{r as y}from"./index-76fb7be0.js";import{c as z,a as V,P as b,V as M,d as F,e as _}from"./version-3b86b29f.js";import"./redux-toolkit.esm-cb9067f1.js";import{e as $,f as j,a as N}from"./development-5b00fac8.js";import{u as U,S as P,M as L,a as K}from"./useSentry-30fb6861.js";import{j as W}from"./index-9d7eb5a2.js";import{P as H,N as O}from"./index-7ad04130.js";import{r as B}from"./index-467b4a8a.js";const D=z(),Q=(t,e)=>!(e!=null&&e.id)&&typeof(e==null?void 0:e.id)!="number"?t:{...t,[V.contentId]:e.id.toString()},G=t=>{const e=(t==null?void 0:t.screenTitle)??(t==null?void 0:t.screenHeaderTitle);if(e)return decodeURIComponent(e)},Y=t=>{if(t)return Object.keys(t).filter(e=>t[e]!==void 0).reduce((e,n)=>({...e,[n]:t[n]}),{})},q={[b.appVersion]:M,[b.appVersionWithBuild]:F},g=t=>Y({...t,...q});function X(t){if(!Number.isInteger(t))throw new Error("Parameter must be an integer number")}function C(t){t&&Object.entries(t).forEach(e=>{let[n,c]=e;const i=parseInt(n,10);if(n!==i.toString())throw new Error("ID (key) must be an integer");if(i<1)throw new Error("ID (key) must be an integer greater than 0")})}function h(t){t.forEach(e=>{let n=e.customDimensions;if(n){if(Object.keys(n).length>20)throw new Error("Max 20 product custom dimensions, 20 is max ID.");C(n)}})}function J(t){if(!/^[0-9a-f]{16}$/.test(t))throw new Error(`Visitor ID ${t} has invalid format. The format must match the regular expression: ^[0-9a-f]{16}$`)}const Z="1.1.0",tt=`The package 'react-native-piwik-pro-sdk' doesn't seem to be linked. Make sure: 

`+H.select({ios:`- You have run 'pod install'
`,default:""})+`- You rebuilt the app after installing the package
- You are not using Expo managed workflow
`,r=O.PiwikProSdk?O.PiwikProSdk:new Proxy({},{get(){throw new Error(tt)}});async function et(t,e){return await r.init(t,e,Z)}async function nt(t,e){return s(e),await r.trackScreen(t,e)}async function rt(t,e,n){return s(n),await r.trackCustomEvent(t,e,n)}async function it(t,e){return s(e),await r.trackException(t,e)}async function at(t,e,n){return s(n),await r.trackSocialInteraction(t,e,n)}async function ct(t,e){return s(e),await r.trackDownload(t,e)}async function st(){return await r.trackApplicationInstall()}async function ot(t,e){return s(e),await r.trackOutlink(t,e)}async function ut(t,e){return s(e),await r.trackSearch(t,e)}async function mt(t,e){return s(e),await r.trackImpression(t,e)}async function lt(t,e,n){return s(n),await r.trackInteraction(t,e,n)}async function ft(t,e){return s(e),await r.trackGoal(t,e)}async function kt(t,e,n){return await r.trackEcommerce(t,e,n)}async function dt(t,e){return s(e),h(t),await r.trackEcommerceProductDetailView(t,e)}async function wt(t,e,n){return s(n),h(t),await r.trackEcommerceCartUpdate(t,e,n)}async function yt(t,e){return s(e),h(t),await r.trackEcommerceAddToCart(t,e)}async function gt(t,e){return s(e),h(t),await r.trackEcommerceRemoveFromCart(t,e)}async function Pt(t,e,n,c){return s(c),h(n),await r.trackEcommerceOrder(t,e,n,c)}async function It(t){return await r.trackCampaign(t)}async function ht(t){if(Array.isArray(t)){if(!t.length)throw new Error("Profile attributes cannot be an empty array");return await r.trackProfileAttributes(t)}return await r.trackProfileAttributes([t])}async function Et(){return await r.getProfileAttributes()}async function vt(t){return await r.checkAudienceMembership(t)}async function Ct(t){return await r.setUserId(t)}async function Dt(){return await r.getUserId()}async function St(t){return await r.setUserEmail(t)}async function _t(){return await r.getUserEmail()}async function bt(t){return J(t),await r.setVisitorId(t)}async function Ot(){return await r.getVisitorId()}async function Rt(t){return await r.setSessionTimeout(t)}async function pt(){return await r.getSessionTimeout()}async function Tt(){return await r.startNewSession()}async function xt(){return await r.dispatch()}async function Vt(t){return X(t),await r.setDispatchInterval(t)}async function Nt(){return await r.getDispatchInterval()}async function Ut(t){return await r.setIncludeDefaultCustomVariables(t)}async function At(){return await r.getIncludeDefaultCustomVariables()}async function zt(t){return await r.setAnonymizationState(t)}async function Mt(){return await r.isAnonymizationOn()}async function Ft(t){return await r.setOptOut(t)}async function $t(t){return await r.setDryRun(t)}async function jt(){return await r.getDryRun()}async function Lt(){return await r.getOptOut()}async function Kt(t){return await r.setPrefixing(t)}async function Wt(){return await r.isPrefixingOn()}function s(t){C(t==null?void 0:t.customDimensions),C(t==null?void 0:t.visitCustomVariables),C(t==null?void 0:t.screenCustomVariables)}const I={init:et,trackScreen:nt,trackCustomEvent:rt,trackException:it,trackSocialInteraction:at,trackDownload:ct,trackApplicationInstall:st,trackOutlink:ot,trackSearch:ut,trackImpression:mt,trackInteraction:lt,trackGoal:ft,trackEcommerce:kt,trackEcommerceProductDetailView:dt,trackEcommerceCartUpdate:wt,trackEcommerceAddToCart:yt,trackEcommerceRemoveFromCart:gt,trackEcommerceOrder:Pt,trackCampaign:It,trackProfileAttributes:ht,getProfileAttributes:Et,checkAudienceMembership:vt,setUserId:Ct,getUserId:Dt,setUserEmail:St,getUserEmail:_t,setVisitorId:bt,getVisitorId:Ot,setSessionTimeout:Rt,getSessionTimeout:pt,startNewSession:Tt,dispatch:xt,setDispatchInterval:Vt,getDispatchInterval:Nt,setIncludeDefaultCustomVariables:Ut,getIncludeDefaultCustomVariables:At,setAnonymizationState:zt,isAnonymizationOn:Mt,setOptOut:Ft,getOptOut:Lt,setDryRun:$t,getDryRun:jt,setPrefixing:Kt,isPrefixingOn:Wt},Ht="",Bt="",Qt="",Gt="",[R,p]=$?[Ht,Bt]:[Qt,Gt],Yt=async()=>!R||!p?Promise.reject(_.missingEnvVars):(await I.init(R,p),await I.trackApplicationInstall(),await I.setIncludeDefaultCustomVariables(!0),Promise.resolve()),S=y.createContext(void 0),T=({children:t})=>{const{sendSentryErrorLog:e}=U(),[n,c]=y.useState();return y.useEffect(()=>{n===void 0&&Yt().then(()=>{c(I)}).catch(i=>{if(i.message===_.alreadyInitialized){c(I);return}c(null),i.message!==_.missingEnvVars&&e(P.piwikInitialization,"piwik.provider.tsx",{error:i})})},[n,e]),W.jsx(S.Provider,{value:n,children:t})};try{S.displayName="PiwikContext",S.__docgenInfo={description:"The PiwikContext contains the object with all methods, to be used via the usePiwik hook only.",displayName:"PiwikContext",props:{}}}catch{}try{T.displayName="PiwikProvider",T.__docgenInfo={description:"",displayName:"PiwikProvider",props:{}}}catch{}const qt=()=>{if(D.isReady()){const t=D.getRootState(),e=t==null?void 0:t.routes;if(e)for(let n=e.length-1;n>=0;n--){const c=L[e[n].name];if(c)return c}}};var x=B();const Xt=t=>{if(!t)return"";const e={};return Object.keys(x.parse(t)).forEach(n=>{e[n]="___"}),`?${x.stringify(e)}`},Jt=t=>t?`#${t.split("/").map(()=>"___").join("/")}`:"",Zt=(t="")=>{const[e,n,...c]=t.split("#"),[i,k,...d]=e.split("?");if(c.length||d.length)return i;const m=Xt(k),f=Jt(n);return`${i}${m}${f}`},E=()=>N("piwik not initialized"),te={ready:!1,trackCustomEvent:E,trackOutlink:E,trackScreen:E,trackSearch:E},v="usePiwik.ts",ee=({trackCustomEvent:t,trackOutlink:e,trackScreen:n,trackSearch:c},i,k,d,m,f)=>({ready:!0,trackCustomEvent:(o,a,u,l=k,w=void 0)=>{j("trackCustomEvent",{name:o,action:a,dimensions:u,category:l,value:w}),t(l,a,{path:m,customDimensions:g(u),value:w}).catch(()=>{i(P.piwikTrackCustomEvent,v,{category:l,action:a,name:o,path:m,value:w})})},trackOutlink:(o,a)=>{const u=Zt(o);e(u,{...a,customDimensions:g({...a==null?void 0:a.customDimensions,[V.routeName]:m})}).catch(()=>{i(P.piwikTrackOutlink,v,{url:u})})},trackScreen:(o,a)=>{const u=o??m;if(!u)return;const l=Q(a==null?void 0:a.customDimensions,f);n(u,{...a,title:G(f),customDimensions:g(l)}).catch(()=>{i(P.piwikTrackScreen,v,{path:o})}),d.trackPageView({name:u},g(l))},trackSearch:(o,a)=>{c(o,{...a,customDimensions:g(a==null?void 0:a.customDimensions)}).catch(()=>{i(P.piwikTrackSearch,v)})}}),ne=()=>{const t=y.useContext(S),{sendSentryErrorLog:e}=U(),n=D.isReady()?D.getCurrentRoute():void 0,c=qt()??"general",i=K();return y.useMemo(()=>t?ee(t,e,c,i,n==null?void 0:n.name,n==null?void 0:n.params):te,[t,e,c,i,n==null?void 0:n.name,n==null?void 0:n.params])},re=t=>{const e=t.logName??t["sentry-label"]??t.testID;return e||N("No name found in props"),e},fe=({logAction:t,logCategory:e,logDimensions:n={},logValue:c,onEvent:i,testID:k,logName:d,"sentry-label":m})=>{const{trackCustomEvent:f}=ne();return y.useCallback((o,{nameSuffix:a,dimensions:u={},action:l=t}={})=>{i==null||i(o);const w=re({testID:k,logName:d,"sentry-label":m});if(w){const A=a?`:${a}`:"";f(`${w}${A}`,l,{...n,...u},e,c)}},[t,e,n,d,c,i,m,k,f])};export{ne as a,qt as g,x as l,fe as u};
